{"version":3,"file":"automation-wizard-CSqxFDzT.js","sources":["../../src/components/automations/automations-wizard/actions-step/action-type-select.tsx","../../src/components/automations/automations-wizard/actions-step/change-flow-run-fields.tsx","../../src/components/automations/automations-wizard/actions-step/flow-run-action-description.tsx","../../src/components/automations/automations-wizard/actions-step/loading-select-state.tsx","../../src/components/automations/automations-wizard/actions-step/select-automations-fields.tsx","../../src/api/deployments/use-list-deployments-with-flows/use-list-deployments-with-flows.ts","../../src/components/automations/automations-wizard/actions-step/select-deployments-fields.tsx","../../src/components/automations/automations-wizard/actions-step/select-work-pools-fields.tsx","../../src/components/automations/automations-wizard/actions-step/select-work-queues-fields.tsx","../../src/components/automations/automations-wizard/actions-step/send-notification-fields.tsx","../../src/components/automations/automations-wizard/actions-step/action-step.tsx","../../src/components/automations/automations-wizard/actions-step/actions-step.tsx","../../src/components/automations/automations-wizard/details-step/details-step.tsx","../../src/components/automations/automations-wizard/trigger-step/posture-select.tsx","../../src/components/automations/automations-wizard/trigger-step/custom-trigger-fields.tsx","../../src/components/automations/automations-wizard/trigger-step/deployment-status-trigger-fields.tsx","../../src/components/flows/flow-multi-select/flow-multi-select.tsx","../../src/components/ui/duration-input/index.tsx","../../src/components/automations/automations-wizard/trigger-step/state-multi-select.tsx","../../src/components/automations/automations-wizard/trigger-step/flow-run-state-trigger-fields.tsx","../../src/components/automations/automations-wizard/trigger-step/form-mode-toggle.tsx","../../src/components/automations/automations-wizard/trigger-step/trigger-json-input.tsx","../../src/components/automations/automations-wizard/automations-trigger-template-select/automations-trigger-template-select.tsx","../../src/components/automations/automations-wizard/trigger-step/trigger-step-utils.ts","../../src/components/work-pools/work-pool-multi-select/work-pool-multi-select.tsx","../../src/components/automations/automations-wizard/trigger-step/work-pool-status-trigger-fields.tsx","../../src/components/automations/automations-wizard/trigger-step/work-pools-combobox.tsx","../../src/components/automations/automations-wizard/trigger-step/work-queues-combobox.tsx","../../src/components/automations/automations-wizard/trigger-step/work-queue-status-trigger-fields.tsx","../../src/components/automations/automations-wizard/trigger-step/trigger-step.tsx","../../src/components/automations/automations-wizard/automation-wizard.tsx"],"sourcesContent":["import { useFormContext } from \"react-hook-form\";\n\nimport {\n\ttype ActionType,\n\ttype AutomationWizardSchema,\n\tUNASSIGNED,\n} from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n} from \"@/components/ui/form\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectGroup,\n\tSelectItem,\n\tSelectLabel,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\n\nconst AUTOMATION_ACTION_TYPES: Partial<Record<ActionType, string>> = {\n\t\"cancel-flow-run\": \"Cancel a flow run\",\n\t\"suspend-flow-run\": \"Suspend a flow run\",\n\t\"resume-flow-run\": \"Resume a flow run\",\n\t\"change-flow-run-state\": \"Change flow run's state\",\n\t\"run-deployment\": \"Run a deployment\",\n\t\"pause-deployment\": \"Pause a deployment\",\n\t\"resume-deployment\": \"Resume a deployment\",\n\t\"pause-work-queue\": \"Pause a work queue\",\n\t\"resume-work-queue\": \"Resume a work queue\",\n\t\"pause-work-pool\": \"Pause a work pool\",\n\t\"resume-work-pool\": \"Resume a work pool\",\n\t\"pause-automation\": \"Pause an automation\",\n\t\"resume-automation\": \"Resume an automation\",\n\t\"send-notification\": \"Send a notification\",\n};\n\nexport const ActionTypeSelect = ({ index }: { index: number }) => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\treturn (\n\t\t<FormField\n\t\t\tcontrol={form.control}\n\t\t\tname={`actions.${index}.type`}\n\t\t\trender={({ field }) => (\n\t\t\t\t<FormItem>\n\t\t\t\t\t<FormLabel>Action Type</FormLabel>\n\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\tonValueChange={(type: ActionType) => {\n\t\t\t\t\t\t\t\tfield.onChange(type);\n\t\t\t\t\t\t\t\tconst defaultActionField = getDefaultActionField({\n\t\t\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (defaultActionField) {\n\t\t\t\t\t\t\t\t\tform.setValue(defaultActionField, UNASSIGNED);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<SelectTrigger aria-label=\"select action\" className=\"w-full\">\n\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select action\" />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t<SelectGroup>\n\t\t\t\t\t\t\t\t\t<SelectLabel>Actions</SelectLabel>\n\t\t\t\t\t\t\t\t\t{Object.keys(AUTOMATION_ACTION_TYPES).map((key) => (\n\t\t\t\t\t\t\t\t\t\t<SelectItem key={key} value={key}>\n\t\t\t\t\t\t\t\t\t\t\t{AUTOMATION_ACTION_TYPES[key as ActionType]}\n\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</SelectGroup>\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</FormControl>\n\t\t\t\t</FormItem>\n\t\t\t)}\n\t\t/>\n\t);\n};\n\n/**\n * @returns form field name to be set that is associated with the passed `type` arg\n */\nfunction getDefaultActionField({\n\tindex,\n\ttype,\n}: {\n\tindex: number;\n\ttype: ActionType;\n}) {\n\tswitch (type) {\n\t\tcase \"run-deployment\":\n\t\tcase \"pause-deployment\":\n\t\tcase \"resume-deployment\":\n\t\t\treturn `actions.${index}.deployment_id` as const;\n\t\tcase \"pause-work-queue\":\n\t\tcase \"resume-work-queue\":\n\t\t\treturn `actions.${index}.work_queue_id` as const;\n\t\tcase \"pause-work-pool\":\n\t\tcase \"resume-work-pool\":\n\t\t\treturn `actions.${index}.work_pool_id` as const;\n\t\tcase \"pause-automation\":\n\t\tcase \"resume-automation\":\n\t\t\treturn `actions.${index}.automation_id` as const;\n\t\t// TODO: add these back in once we have field names for them\n\t\t// case \"send-notification\":\n\t\t// case \"cancel-flow-run\":\n\t\t// case \"suspend-flow-run\":\n\t\t// case \"resume-flow-run\":\n\t\t// case \"change-flow-run-state\":\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n","import { useFormContext } from \"react-hook-form\";\nimport { RUN_STATES } from \"@/api/flow-runs/constants\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { StateSelect } from \"@/components/ui/state-select\";\nimport { Textarea } from \"@/components/ui/textarea\";\n\ntype ChangeFlowRunStateFieldsProps = {\n\tindex: number;\n};\n\nexport const ChangeFlowRunStateFields = ({\n\tindex,\n}: ChangeFlowRunStateFieldsProps) => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst stateField = form.watch(`actions.${index}.state`);\n\n\treturn (\n\t\t<>\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname={`actions.${index}.state`}\n\t\t\t\trender={({ field }) => (\n\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t<FormLabel>State</FormLabel>\n\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t<StateSelect value={field.value} onValueChange={field.onChange} />\n\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t)}\n\t\t\t/>\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname={`actions.${index}.name`}\n\t\t\t\trender={({ field }) => (\n\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t<FormLabel>Name</FormLabel>\n\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\t\tvalue={field.value ?? \"\"}\n\t\t\t\t\t\t\t\tplaceholder={stateField ? RUN_STATES[stateField] : undefined}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t)}\n\t\t\t/>\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname={`actions.${index}.message`}\n\t\t\t\trender={({ field }) => (\n\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t<FormLabel>Message</FormLabel>\n\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\t\tplaceholder=\"State changed by Automation <id>\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t)}\n\t\t\t/>\n\t\t</>\n\t);\n};\n","import { Typography } from \"@/components/ui/typography\";\n\ntype FlowRunActionDescriptionProps = {\n\taction: \"Suspend\" | \"Cancel\" | \"Resume\";\n};\n\nexport const FlowRunActionDescription = ({\n\taction,\n}: FlowRunActionDescriptionProps) => {\n\t// Vue uses different text for resume vs cancel/suspend:\n\t// - Cancel/Suspend: \"{Action} flow run inferred from the triggering event\"\n\t// - Resume: \"Resume a flow run inferred from the triggering event\"\n\tconst text =\n\t\taction === \"Resume\"\n\t\t\t? \"Resume a flow run inferred from the triggering event\"\n\t\t\t: `${action} flow run inferred from the triggering event`;\n\n\treturn (\n\t\t<Typography variant=\"bodySmall\" className=\"text-muted-foreground\">\n\t\t\t{text}\n\t\t</Typography>\n\t);\n};\n","import { Skeleton } from \"@/components/ui/skeleton\";\n\nconst DEFAULT_NUM_SKELETONS = 4;\n\ntype LoadingSelectStateProps = {\n\tlength?: number;\n};\n\nexport const LoadingSelectState = ({\n\tlength = DEFAULT_NUM_SKELETONS,\n}: LoadingSelectStateProps) =>\n\tArray.from({ length }, (_, index) => (\n\t\t// biome-ignore lint/suspicious/noArrayIndexKey: ok for loading skeletons\n\t\t<Skeleton key={index} className=\"mt-2 p-4 h-2 w-full\" />\n\t));\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { useFormContext } from \"react-hook-form\";\nimport { type Automation, buildListAutomationsQuery } from \"@/api/automations\";\nimport {\n\ttype AutomationWizardSchema,\n\tUNASSIGNED,\n} from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport {\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { LoadingSelectState } from \"./loading-select-state\";\n\nconst INFER_OPTION = {\n\tvalue: UNASSIGNED,\n\tname: \"Infer Automation\",\n} as const;\n\ntype SelectAutomationsFieldsProps = {\n\taction: \"Pause\" | \"Resume\";\n\tindex: number;\n};\n\nconst getButtonLabel = (\n\tdata: Array<Automation> | undefined,\n\tfieldValue: string | null,\n) => {\n\tif (fieldValue === INFER_OPTION.value) {\n\t\treturn INFER_OPTION.name;\n\t}\n\tconst automation = data?.find((automation) => automation.id === fieldValue);\n\tif (automation) {\n\t\treturn automation.name;\n\t}\n\treturn undefined;\n};\n\nexport const SelectAutomationsFields = ({\n\taction,\n\tindex,\n}: SelectAutomationsFieldsProps) => {\n\tconst [search, setSearch] = useState(\"\");\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst { data, isSuccess } = useQuery(buildListAutomationsQuery());\n\n\t// nb: because automations API does not have filtering _like by name, do client-side filtering\n\tconst deferredSearch = useDeferredValue(search);\n\tconst filteredData = useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn [];\n\t\t}\n\t\treturn data.filter((automation) =>\n\t\t\tautomation.name.toLowerCase().includes(deferredSearch.toLowerCase()),\n\t\t);\n\t}, [data, deferredSearch]);\n\n\tconst isInferredOptionFiltered = INFER_OPTION.name\n\t\t.toLowerCase()\n\t\t.includes(deferredSearch.toLowerCase());\n\n\treturn (\n\t\t<FormField\n\t\t\tcontrol={form.control}\n\t\t\tname={`actions.${index}.automation_id`}\n\t\t\trender={({ field }) => {\n\t\t\t\tconst buttonLabel = getButtonLabel(data, field.value);\n\t\t\t\treturn (\n\t\t\t\t\t<FormItem className=\"flex flex-col\">\n\t\t\t\t\t\t<FormLabel>Automation To {action}</FormLabel>\n\t\t\t\t\t\t<Combobox>\n\t\t\t\t\t\t\t<ComboboxTrigger\n\t\t\t\t\t\t\t\tselected={Boolean(buttonLabel)}\n\t\t\t\t\t\t\t\taria-label={`Select Automation to ${action}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{buttonLabel ?? \"Select automation\"}\n\t\t\t\t\t\t\t</ComboboxTrigger>\n\t\t\t\t\t\t\t<ComboboxContent>\n\t\t\t\t\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\t\t\t\t\tvalue={search}\n\t\t\t\t\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Search for an automation...\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<ComboboxCommandEmtpy>No automation found</ComboboxCommandEmtpy>\n\t\t\t\t\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t\t\t{isInferredOptionFiltered && (\n\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t\tonSelect={(value) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfield.onChange(value);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{INFER_OPTION.name}\n\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{isSuccess ? (\n\t\t\t\t\t\t\t\t\t\t\tfilteredData.map((automation) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={automation.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === automation.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={(value) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfield.onChange(value);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={automation.id}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{automation.name}\n\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<LoadingSelectState />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t</ComboboxCommandList>\n\t\t\t\t\t\t\t</ComboboxContent>\n\t\t\t\t\t\t</Combobox>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t);\n\t\t\t}}\n\t\t/>\n\t);\n};\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useMemo } from \"react\";\nimport {\n\tbuildPaginateDeploymentsQuery,\n\ttype Deployment,\n\ttype DeploymentsPaginationFilter,\n} from \"@/api/deployments\";\nimport { buildListFlowsQuery, type Flow } from \"@/api/flows\";\n\nexport type DeploymentWithFlow = Deployment & {\n\tflow: Flow | undefined;\n};\n\n/**\n * A hook that is used to get a pagination list of Deployments, with flow data joined\n *\n * @returns a pagination list of deployments, joined with flow data\n *\n *  @example\n * ```tsx\nfunction DeploymentListWithFlows() {\n\tconst { data, status } = useListDeploymentsWithFlows();\n    \n\tif (data) {\n\t\treturn (\n\t\t\t<ul>\n\t\t\t\t{data.results.map((deployment) => {\n\t\t\t\t\tconst label = deployment.flow\n\t\t\t\t\t\t? `${deployment.flow.name} > ${deployment.name}`\n\t\t\t\t\t\t: deployment.name;\n\t\t\t\t\treturn <li key={deployment.id}>{label}</li>;\n\t\t\t\t})}\n\t\t\t</ul>\n\t\t);\n\t}\n\n\tif (status === \"error\") {\n\t\treturn <p>Error has occurred</p>;\n\t}\n\n\treturn <div>Loading...</div>;\n}\n * ```\n */\nexport const useListDeploymentsWithFlows = (\n\tfilter: DeploymentsPaginationFilter = {\n\t\tpage: 1,\n\t\tlimit: 100,\n\t\tsort: \"NAME_ASC\",\n\t},\n) => {\n\tconst { data: deploymentsData, status: deploymentsStatus } = useQuery(\n\t\tbuildPaginateDeploymentsQuery(filter),\n\t);\n\n\t// Creates a set of unique flow ids\n\tconst deploymentsFlowIds = new Set(\n\t\tdeploymentsData?.results.map((deployment) => deployment.flow_id),\n\t);\n\n\tconst { data: flowsData, status: flowsStatus } = useQuery(\n\t\tbuildListFlowsQuery(\n\t\t\t{\n\t\t\t\tflows: {\n\t\t\t\t\toperator: \"or_\",\n\t\t\t\t\tid: { any_: Array.from(deploymentsFlowIds) },\n\t\t\t\t},\n\t\t\t\tsort: \"NAME_DESC\",\n\t\t\t\toffset: 0,\n\t\t\t},\n\t\t\t{ enabled: deploymentsFlowIds.size > 0 },\n\t\t),\n\t);\n\n\treturn useMemo(() => {\n\t\tif (flowsData && deploymentsData) {\n\t\t\tconst flowMap = new Map<string, Flow>(\n\t\t\t\tflowsData.map((flow) => [flow.id, flow]),\n\t\t\t);\n\t\t\t// Normalize data per deployment with deployment & flow\n\t\t\tconst deploymentsWithFlows = deploymentsData.results.map(\n\t\t\t\t(deployment) => ({\n\t\t\t\t\t...deployment,\n\t\t\t\t\tflow: flowMap.get(deployment.flow_id),\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tconst { count, limit, pages, page } = deploymentsData;\n\t\t\tconst retData = {\n\t\t\t\tcount,\n\t\t\t\tlimit,\n\t\t\t\tpages,\n\t\t\t\tpage,\n\t\t\t\tresults: deploymentsWithFlows,\n\t\t\t};\n\t\t\treturn {\n\t\t\t\tdata: retData,\n\t\t\t\tstatus: \"success\",\n\t\t\t};\n\t\t}\n\n\t\tif (flowsStatus === \"error\" || deploymentsStatus === \"error\") {\n\t\t\treturn {\n\t\t\t\tdata: undefined,\n\t\t\t\tstatus: \"error\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tdata: undefined,\n\t\t\tstatus: \"pending\",\n\t\t};\n\t}, [deploymentsData, deploymentsStatus, flowsData, flowsStatus]);\n};\n","import { useState } from \"react\";\nimport { useFormContext, useWatch } from \"react-hook-form\";\nimport type { DeploymentWithFlow } from \"@/api/deployments\";\nimport { useListDeploymentsWithFlows } from \"@/api/deployments/use-list-deployments-with-flows\";\nimport {\n\ttype AutomationWizardSchema,\n\tUNASSIGNED,\n} from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport {\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { Icon } from \"@/components/ui/icons\";\nimport useDebounce from \"@/hooks/use-debounce\";\nimport { LoadingSelectState } from \"./loading-select-state\";\n\nconst INFER_OPTION = {\n\tvalue: UNASSIGNED,\n\tname: \"Infer Deployment\",\n} as const;\n\nconst getButtonLabel = (\n\tdata: Array<DeploymentWithFlow> | undefined,\n\tfieldValue: string | null,\n) => {\n\tif (fieldValue === INFER_OPTION.value) {\n\t\treturn INFER_OPTION.name;\n\t}\n\tconst deployment = data?.find((d) => d.id === fieldValue);\n\tif (!deployment) {\n\t\treturn undefined;\n\t}\n\treturn <DeploymentLabel deploymentWithFlow={deployment} />;\n};\n\ntype SelectDeploymentsFieldsProps = {\n\taction: \"Run\" | \"Pause\" | \"Resume\";\n\tindex: number;\n};\n\nexport const SelectDeploymentsFields = ({\n\taction,\n\tindex,\n}: SelectDeploymentsFieldsProps) => {\n\tconst [search, setSearch] = useState(\"\");\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst actionType = form.watch(`actions.${index}.type`);\n\tconst deploymentId = useWatch<AutomationWizardSchema>({\n\t\tname: `actions.${index}.deployment_id`,\n\t});\n\n\tconst debouncedSearch = useDebounce(search, 500);\n\tconst { data } = useListDeploymentsWithFlows({\n\t\tpage: 1,\n\t\tsort: \"NAME_ASC\",\n\t\tdeployments: {\n\t\t\toperator: \"or_\",\n\t\t\tflow_or_deployment_name: {\n\t\t\t\tlike_: debouncedSearch,\n\t\t\t},\n\t\t},\n\t});\n\n\tconst isInferredOptionFiltered = INFER_OPTION.name\n\t\t.toLowerCase()\n\t\t.includes(search.toLowerCase());\n\n\tconst deploymentsWithFlows = data?.results;\n\n\treturn (\n\t\t<>\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname={`actions.${index}.deployment_id`}\n\t\t\t\trender={({ field }) => {\n\t\t\t\t\tconst buttonLabel = getButtonLabel(deploymentsWithFlows, field.value);\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<FormItem className=\"flex flex-col\">\n\t\t\t\t\t\t\t<FormLabel>Deployment To {action}</FormLabel>\n\t\t\t\t\t\t\t<Combobox>\n\t\t\t\t\t\t\t\t<ComboboxTrigger\n\t\t\t\t\t\t\t\t\tselected={Boolean(buttonLabel)}\n\t\t\t\t\t\t\t\t\taria-label={`Select Deployment to ${action}`}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{buttonLabel ?? \"Select deployment\"}\n\t\t\t\t\t\t\t\t</ComboboxTrigger>\n\t\t\t\t\t\t\t\t<ComboboxContent>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\t\t\t\t\t\tvalue={search}\n\t\t\t\t\t\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search for an deployment...\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandEmtpy>\n\t\t\t\t\t\t\t\t\t\tNo deployment found\n\t\t\t\t\t\t\t\t\t</ComboboxCommandEmtpy>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t\t\t\t{isInferredOptionFiltered && (\n\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={field.onChange}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{INFER_OPTION.name}\n\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{deploymentsWithFlows ? (\n\t\t\t\t\t\t\t\t\t\t\t\tdeploymentsWithFlows.map((deployment) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={deployment.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={deployment.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === deployment.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={field.onChange}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={deployment.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<DeploymentLabel deploymentWithFlow={deployment} />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t<LoadingSelectState />\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t\t</ComboboxCommandList>\n\t\t\t\t\t\t\t\t</ComboboxContent>\n\t\t\t\t\t\t\t</Combobox>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t{deploymentId !== INFER_OPTION.value &&\n\t\t\t\tactionType === \"run-deployment\" && <div>TODO: Additional fields</div>}\n\t\t</>\n\t);\n};\n\ntype DeploymentLabelProps = {\n\tdeploymentWithFlow: DeploymentWithFlow;\n};\nconst DeploymentLabel = ({ deploymentWithFlow }: DeploymentLabelProps) => {\n\tif (deploymentWithFlow.flow) {\n\t\treturn (\n\t\t\t<div className=\"flex items-center gap-0.5\">\n\t\t\t\t<div>{deploymentWithFlow.flow.name}</div>\n\t\t\t\t<Icon className=\"size-4\" id=\"ChevronRight\" />\n\t\t\t\t<div>{deploymentWithFlow.name}</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn deploymentWithFlow.name;\n};\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { useFormContext } from \"react-hook-form\";\nimport { buildFilterWorkPoolsQuery, type WorkPool } from \"@/api/work-pools\";\nimport {\n\ttype AutomationWizardSchema,\n\tUNASSIGNED,\n} from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport {\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { LoadingSelectState } from \"./loading-select-state\";\n\nconst INFER_OPTION = {\n\tvalue: UNASSIGNED,\n\tname: \"Infer Work Pool\" as const,\n} as const;\n\ntype SelectWorkPoolFieldsProps = {\n\taction: \"Pause\" | \"Resume\";\n\tindex: number;\n};\n\nconst getButtonLabel = (\n\tdata: Array<WorkPool> | undefined,\n\tfieldValue: string | null,\n) => {\n\tif (fieldValue === INFER_OPTION.value) {\n\t\treturn INFER_OPTION.name;\n\t}\n\tconst workPool = data?.find((wp) => wp.id === fieldValue);\n\tif (workPool) {\n\t\treturn workPool.name;\n\t}\n\treturn undefined;\n};\n\nexport const SelectWorkPoolsFields = ({\n\taction,\n\tindex,\n}: SelectWorkPoolFieldsProps) => {\n\tconst [search, setSearch] = useState(\"\");\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst { data, isSuccess } = useQuery(buildFilterWorkPoolsQuery());\n\n\t// nb: because work pools API does not have filtering _like by name, do client-side filtering\n\tconst deferredSearch = useDeferredValue(search);\n\tconst filteredData = useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn [];\n\t\t}\n\t\treturn data.filter((workPool) =>\n\t\t\tworkPool.name.toLowerCase().includes(deferredSearch.toLowerCase()),\n\t\t);\n\t}, [data, deferredSearch]);\n\n\tconst isInferredOptionFiltered = INFER_OPTION.name\n\t\t.toLowerCase()\n\t\t.includes(deferredSearch.toLowerCase());\n\n\treturn (\n\t\t<FormField\n\t\t\tcontrol={form.control}\n\t\t\tname={`actions.${index}.work_pool_id`}\n\t\t\trender={({ field }) => {\n\t\t\t\tconst buttonLabel = getButtonLabel(data, field.value);\n\t\t\t\treturn (\n\t\t\t\t\t<FormItem className=\"flex flex-col\">\n\t\t\t\t\t\t<FormLabel>Work Pool To {action}</FormLabel>\n\t\t\t\t\t\t<Combobox>\n\t\t\t\t\t\t\t<ComboboxTrigger\n\t\t\t\t\t\t\t\tselected={Boolean(buttonLabel)}\n\t\t\t\t\t\t\t\taria-label={`Select Work Pool to ${action}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{buttonLabel ?? \"Select Work Pool\"}\n\t\t\t\t\t\t\t</ComboboxTrigger>\n\t\t\t\t\t\t\t<ComboboxContent>\n\t\t\t\t\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\t\t\t\t\tvalue={search}\n\t\t\t\t\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Search for a work pool...\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<ComboboxCommandEmtpy>No work pool found</ComboboxCommandEmtpy>\n\t\t\t\t\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t\t\t{isInferredOptionFiltered && (\n\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t\tonSelect={(value) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfield.onChange(value);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{INFER_OPTION.name}\n\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{isSuccess ? (\n\t\t\t\t\t\t\t\t\t\t\tfilteredData.map((workPool) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={workPool.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === workPool.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={(value) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfield.onChange(value);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={workPool.id}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{workPool.name}\n\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<LoadingSelectState />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t</ComboboxCommandList>\n\t\t\t\t\t\t\t</ComboboxContent>\n\t\t\t\t\t\t</Combobox>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t);\n\t\t\t}}\n\t\t/>\n\t);\n};\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { useFormContext } from \"react-hook-form\";\nimport { buildFilterWorkQueuesQuery, type WorkQueue } from \"@/api/work-queues\";\nimport {\n\ttype AutomationWizardSchema,\n\tUNASSIGNED,\n} from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport {\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { LoadingSelectState } from \"./loading-select-state\";\n\nconst INFER_OPTION = {\n\tvalue: UNASSIGNED,\n\tname: \"Infer Work Queue\" as const,\n} as const;\n\ntype SelectWorkQueuesFieldsProps = {\n\taction: \"Pause\" | \"Resume\";\n\tindex: number;\n};\n\nconst getButtonLabel = (\n\tdata: Array<WorkQueue> | undefined,\n\tfieldValue: string | null,\n) => {\n\tif (fieldValue === INFER_OPTION.value) {\n\t\treturn INFER_OPTION.name;\n\t}\n\tconst workQueue = data?.find((wq) => wq.id === fieldValue);\n\tif (workQueue) {\n\t\treturn workQueue.name;\n\t}\n\treturn undefined;\n};\n\nexport const SelectWorkQueuesFields = ({\n\taction,\n\tindex,\n}: SelectWorkQueuesFieldsProps) => {\n\tconst [search, setSearch] = useState(\"\");\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst { data } = useQuery(buildFilterWorkQueuesQuery());\n\n\t// nb: because work queues API does not have filtering _like by name, do client-side filtering\n\tconst deferredSearch = useDeferredValue(search);\n\n\t// Filters data, but returns as a map of work_pool_name vs work queues\n\tconst filteredMap = useMemo(() => {\n\t\tif (!data) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst filteredMap = new Map<string, Array<WorkQueue>>();\n\t\tconst filteredWorkQueues = data.filter((workQueue) =>\n\t\t\tworkQueue.name.toLowerCase().includes(deferredSearch.toLowerCase()),\n\t\t);\n\t\tfor (const wq of filteredWorkQueues) {\n\t\t\tconst { work_pool_name } = wq;\n\t\t\tif (!work_pool_name) {\n\t\t\t\tthrow new Error(\"'work_pool_name expected\");\n\t\t\t}\n\t\t\tfilteredMap.set(work_pool_name, [\n\t\t\t\t...(filteredMap.get(work_pool_name) ?? []),\n\t\t\t\twq,\n\t\t\t]);\n\t\t}\n\n\t\treturn filteredMap;\n\t}, [data, deferredSearch]);\n\n\tconst isInferredOptionFiltered = INFER_OPTION.name\n\t\t.toLowerCase()\n\t\t.includes(deferredSearch.toLowerCase());\n\n\treturn (\n\t\t<FormField\n\t\t\tcontrol={form.control}\n\t\t\tname={`actions.${index}.work_queue_id`}\n\t\t\trender={({ field }) => {\n\t\t\t\tconst buttonLabel = getButtonLabel(data, field.value);\n\t\t\t\treturn (\n\t\t\t\t\t<FormItem className=\"flex flex-col\">\n\t\t\t\t\t\t<FormLabel>Work Queue To {action}</FormLabel>\n\t\t\t\t\t\t<Combobox>\n\t\t\t\t\t\t\t<ComboboxTrigger\n\t\t\t\t\t\t\t\tselected={Boolean(buttonLabel)}\n\t\t\t\t\t\t\t\taria-label={`Select Work Queue to ${action}`}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{buttonLabel ?? \"Select Work Queue\"}\n\t\t\t\t\t\t\t</ComboboxTrigger>\n\t\t\t\t\t\t\t<ComboboxContent>\n\t\t\t\t\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\t\t\t\t\tvalue={search}\n\t\t\t\t\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\t\t\t\t\tplaceholder=\"Search for a work queue...\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<ComboboxCommandEmtpy>No work queue found</ComboboxCommandEmtpy>\n\t\t\t\t\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t\t\t{isInferredOptionFiltered && (\n\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t\tonSelect={(value) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfield.onChange(value);\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={INFER_OPTION.value}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{INFER_OPTION.name}\n\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{filteredMap ? (\n\t\t\t\t\t\t\t\t\t\t\tArray.from(filteredMap).map(\n\t\t\t\t\t\t\t\t\t\t\t\t([workPoolName, workQueues]) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div key={workPoolName} className=\"border-b\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem disabled>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{workPoolName}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{workQueues.map((workQueue) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={workQueue.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === workQueue.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={(value) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfield.onChange(value);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={workQueue.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{workQueue.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<LoadingSelectState />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t</ComboboxCommandList>\n\t\t\t\t\t\t\t</ComboboxContent>\n\t\t\t\t\t\t</Combobox>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t);\n\t\t\t}}\n\t\t/>\n\t);\n};\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useFormContext } from \"react-hook-form\";\nimport { useValidateTemplate } from \"@/api/automations\";\nimport {\n\ttype BlockDocument,\n\tbuildListFilterBlockDocumentsQuery,\n} from \"@/api/block-documents\";\nimport { buildListFilterBlockTypesQuery } from \"@/api/block-types\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { Icon } from \"@/components/ui/icons\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport useDebounce from \"@/hooks/use-debounce\";\nimport { LoadingSelectState } from \"./loading-select-state\";\n\ntype SendNotificationFieldsProps = {\n\tindex: number;\n};\n\nexport const SendNotificationFields = ({\n\tindex,\n}: SendNotificationFieldsProps) => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst [search, setSearch] = useState(\"\");\n\n\tconst { data: blockTypes, isLoading: isLoadingBlockTypes } = useQuery(\n\t\tbuildListFilterBlockTypesQuery({\n\t\t\toffset: 0,\n\t\t\tblock_schemas: {\n\t\t\t\toperator: \"and_\",\n\t\t\t\tblock_capabilities: { all_: [\"notify\"] },\n\t\t\t},\n\t\t}),\n\t);\n\n\tconst blockTypeSlugs = useMemo(\n\t\t() => blockTypes?.map((bt) => bt.slug) ?? [],\n\t\t[blockTypes],\n\t);\n\n\tconst { data: blockDocuments, isLoading: isLoadingBlockDocuments } = useQuery(\n\t\tbuildListFilterBlockDocumentsQuery(\n\t\t\t{\n\t\t\t\tblock_types:\n\t\t\t\t\tblockTypeSlugs.length > 0\n\t\t\t\t\t\t? { slug: { any_: blockTypeSlugs } }\n\t\t\t\t\t\t: undefined,\n\t\t\t\tinclude_secrets: false,\n\t\t\t\tsort: \"BLOCK_TYPE_AND_NAME_ASC\",\n\t\t\t\toffset: 0,\n\t\t\t},\n\t\t\t{ enabled: blockTypeSlugs.length > 0 },\n\t\t),\n\t);\n\n\tconst isLoading = isLoadingBlockTypes || isLoadingBlockDocuments;\n\n\tconst groupedBlockDocuments = useMemo(() => {\n\t\tif (!blockTypes || !blockDocuments) return [];\n\n\t\treturn blockTypes\n\t\t\t.map((blockType) => ({\n\t\t\t\tblockType,\n\t\t\t\tdocuments: blockDocuments.filter(\n\t\t\t\t\t(doc) => doc.block_type_id === blockType.id,\n\t\t\t\t),\n\t\t\t}))\n\t\t\t.filter((group) => group.documents.length > 0);\n\t}, [blockTypes, blockDocuments]);\n\n\tconst filteredGroups = useMemo(() => {\n\t\tif (!search) return groupedBlockDocuments;\n\n\t\tconst lowerSearch = search.toLowerCase();\n\t\treturn groupedBlockDocuments\n\t\t\t.map((group) => ({\n\t\t\t\t...group,\n\t\t\t\tdocuments: group.documents.filter((doc) =>\n\t\t\t\t\tdoc.name?.toLowerCase().includes(lowerSearch),\n\t\t\t\t),\n\t\t\t}))\n\t\t\t.filter((group) => group.documents.length > 0);\n\t}, [groupedBlockDocuments, search]);\n\n\tconst getSelectedBlockDocument = useCallback(\n\t\t(blockDocumentId: string | undefined): BlockDocument | undefined => {\n\t\t\tif (!blockDocumentId || !blockDocuments) return undefined;\n\t\t\treturn blockDocuments.find((doc) => doc.id === blockDocumentId);\n\t\t},\n\t\t[blockDocuments],\n\t);\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname={`actions.${index}.block_document_id`}\n\t\t\t\trender={({ field }) => {\n\t\t\t\t\tconst selectedDoc = getSelectedBlockDocument(field.value);\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<FormItem className=\"flex flex-col\">\n\t\t\t\t\t\t\t<FormLabel>Block</FormLabel>\n\t\t\t\t\t\t\t<Combobox>\n\t\t\t\t\t\t\t\t<ComboboxTrigger\n\t\t\t\t\t\t\t\t\tselected={Boolean(selectedDoc)}\n\t\t\t\t\t\t\t\t\taria-label=\"Select notification block\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{selectedDoc\n\t\t\t\t\t\t\t\t\t\t? selectedDoc.name\n\t\t\t\t\t\t\t\t\t\t: \"Select a notification block\"}\n\t\t\t\t\t\t\t\t</ComboboxTrigger>\n\t\t\t\t\t\t\t\t<ComboboxContent>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\t\t\t\t\t\tvalue={search}\n\t\t\t\t\t\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Search for a block...\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandEmtpy>\n\t\t\t\t\t\t\t\t\t\tNo notification blocks found\n\t\t\t\t\t\t\t\t\t</ComboboxCommandEmtpy>\n\t\t\t\t\t\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t\t\t\t\t\t{isLoading ? (\n\t\t\t\t\t\t\t\t\t\t\t<LoadingSelectState />\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\tfilteredGroups.map((group) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandGroup\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={group.blockType.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\theading={group.blockType.name}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{group.documents.map((doc) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={doc.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={doc.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselected={field.value === doc.id}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonSelect={field.onChange}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{doc.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</ComboboxCommandList>\n\t\t\t\t\t\t\t\t</ComboboxContent>\n\t\t\t\t\t\t\t</Combobox>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t/>\n\n\t\t\t<TemplateField\n\t\t\t\tindex={index}\n\t\t\t\tname=\"subject\"\n\t\t\t\tlabel=\"Subject\"\n\t\t\t\tplaceholder=\"Enter notification subject...\"\n\t\t\t/>\n\n\t\t\t<TemplateField\n\t\t\t\tindex={index}\n\t\t\t\tname=\"body\"\n\t\t\t\tlabel=\"Body\"\n\t\t\t\tplaceholder=\"Enter notification body...\"\n\t\t\t\tmultiline\n\t\t\t/>\n\n\t\t\t<div className=\"flex items-start gap-2 rounded-md border border-blue-200 bg-blue-50 p-3 text-sm text-blue-800 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-200\">\n\t\t\t\t<Icon id=\"Info\" className=\"mt-0.5 size-4 shrink-0\" />\n\t\t\t\t<p>\n\t\t\t\t\tIn addition to any fields present on the triggering event, the\n\t\t\t\t\tfollowing objects can be used in notification templates:{\" \"}\n\t\t\t\t\t<code className=\"rounded bg-blue-100 px-1 py-0.5 font-mono text-xs dark:bg-blue-900\">\n\t\t\t\t\t\tflow\n\t\t\t\t\t</code>\n\t\t\t\t\t,{\" \"}\n\t\t\t\t\t<code className=\"rounded bg-blue-100 px-1 py-0.5 font-mono text-xs dark:bg-blue-900\">\n\t\t\t\t\t\tdeployment\n\t\t\t\t\t</code>\n\t\t\t\t\t,{\" \"}\n\t\t\t\t\t<code className=\"rounded bg-blue-100 px-1 py-0.5 font-mono text-xs dark:bg-blue-900\">\n\t\t\t\t\t\tflow_run\n\t\t\t\t\t</code>\n\t\t\t\t\t,{\" \"}\n\t\t\t\t\t<code className=\"rounded bg-blue-100 px-1 py-0.5 font-mono text-xs dark:bg-blue-900\">\n\t\t\t\t\t\twork_pool\n\t\t\t\t\t</code>\n\t\t\t\t\t,{\" \"}\n\t\t\t\t\t<code className=\"rounded bg-blue-100 px-1 py-0.5 font-mono text-xs dark:bg-blue-900\">\n\t\t\t\t\t\twork_queue\n\t\t\t\t\t</code>\n\t\t\t\t\t, and{\" \"}\n\t\t\t\t\t<code className=\"rounded bg-blue-100 px-1 py-0.5 font-mono text-xs dark:bg-blue-900\">\n\t\t\t\t\t\tmetric\n\t\t\t\t\t</code>\n\t\t\t\t\t.\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\ntype TemplateFieldProps = {\n\tindex: number;\n\tname: \"subject\" | \"body\";\n\tlabel: string;\n\tplaceholder?: string;\n\tmultiline?: boolean;\n};\n\nconst TemplateField = ({\n\tindex,\n\tname,\n\tlabel,\n\tplaceholder,\n\tmultiline = false,\n}: TemplateFieldProps) => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst { validateTemplate } = useValidateTemplate();\n\tconst [validationError, setValidationError] = useState<string | null>(null);\n\tconst [isValidating, setIsValidating] = useState(false);\n\n\tconst fieldValue = form.watch(`actions.${index}.${name}`);\n\tconst debouncedValue = useDebounce(fieldValue, 1000);\n\n\tuseEffect(() => {\n\t\tconst validate = async () => {\n\t\t\tif (!debouncedValue || debouncedValue.trim() === \"\") {\n\t\t\t\tsetValidationError(null);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetIsValidating(true);\n\t\t\ttry {\n\t\t\t\tconst result = await validateTemplate(debouncedValue);\n\t\t\t\tif (result.valid) {\n\t\t\t\t\tsetValidationError(null);\n\t\t\t\t} else {\n\t\t\t\t\tsetValidationError(result.error);\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\tsetValidationError(null);\n\t\t\t} finally {\n\t\t\t\tsetIsValidating(false);\n\t\t\t}\n\t\t};\n\n\t\tvoid validate();\n\t}, [debouncedValue, validateTemplate]);\n\n\tconst InputComponent = multiline ? Textarea : Input;\n\n\treturn (\n\t\t<FormField\n\t\t\tcontrol={form.control}\n\t\t\tname={`actions.${index}.${name}`}\n\t\t\trender={({ field }) => (\n\t\t\t\t<FormItem>\n\t\t\t\t\t<FormLabel className=\"flex items-center gap-2\">\n\t\t\t\t\t\t{label}\n\t\t\t\t\t\t{isValidating && (\n\t\t\t\t\t\t\t<Icon id=\"Loader2\" className=\"size-3 animate-spin\" />\n\t\t\t\t\t\t)}\n\t\t\t\t\t</FormLabel>\n\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t<InputComponent\n\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\tvalue={field.value ?? \"\"}\n\t\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\t\tclassName={validationError ? \"border-destructive\" : \"\"}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FormControl>\n\t\t\t\t\t{validationError && (\n\t\t\t\t\t\t<p className=\"text-sm text-destructive\">{validationError}</p>\n\t\t\t\t\t)}\n\t\t\t\t\t<FormMessage />\n\t\t\t\t</FormItem>\n\t\t\t)}\n\t\t/>\n\t);\n};\n","import { useWatch } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Icon } from \"@/components/ui/icons\";\nimport { Typography } from \"@/components/ui/typography\";\nimport { ActionTypeSelect } from \"./action-type-select\";\nimport { ChangeFlowRunStateFields } from \"./change-flow-run-fields\";\nimport { FlowRunActionDescription } from \"./flow-run-action-description\";\nimport { SelectAutomationsFields } from \"./select-automations-fields\";\nimport { SelectDeploymentsFields } from \"./select-deployments-fields\";\nimport { SelectWorkPoolsFields } from \"./select-work-pools-fields\";\nimport { SelectWorkQueuesFields } from \"./select-work-queues-fields\";\nimport { SendNotificationFields } from \"./send-notification-fields\";\n\ntype ActionStepProps = {\n\tindex: number;\n\tonRemove: () => void;\n};\n\nexport const ActionStep = ({ index, onRemove }: ActionStepProps) => {\n\treturn (\n\t\t<div key={index} className=\"space-y-2\">\n\t\t\t<div className=\"flex justify-between items-center\">\n\t\t\t\t<Typography variant=\"body\" className=\"font-semibold\">\n\t\t\t\t\tAction {index + 1}\n\t\t\t\t</Typography>\n\t\t\t\t<Button\n\t\t\t\t\tsize=\"icon\"\n\t\t\t\t\taria-label={`remove action ${index + 1}`}\n\t\t\t\t\tonClick={onRemove}\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t>\n\t\t\t\t\t<Icon id=\"Trash2\" className=\"size-4\" />\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t\t<ActionTypeSelect index={index} />\n\t\t\t<ActionTypeAdditionalFields index={index} />\n\t\t\t<hr className=\"my-8\" />\n\t\t</div>\n\t);\n};\n\ntype ActionTypeAdditionalFieldsProps = {\n\tindex: number;\n};\n\nconst ActionTypeAdditionalFields = ({\n\tindex,\n}: ActionTypeAdditionalFieldsProps) => {\n\tconst actionType = useWatch<AutomationWizardSchema>({\n\t\tname: `actions.${index}.type`,\n\t});\n\tswitch (actionType) {\n\t\tcase \"change-flow-run-state\":\n\t\t\treturn <ChangeFlowRunStateFields index={index} />;\n\t\tcase \"run-deployment\":\n\t\t\treturn <SelectDeploymentsFields action=\"Run\" index={index} />;\n\t\tcase \"pause-deployment\":\n\t\t\treturn <SelectDeploymentsFields action=\"Pause\" index={index} />;\n\t\tcase \"resume-deployment\":\n\t\t\treturn <SelectDeploymentsFields action=\"Resume\" index={index} />;\n\t\tcase \"pause-work-queue\":\n\t\t\treturn <SelectWorkQueuesFields action=\"Pause\" index={index} />;\n\t\tcase \"resume-work-queue\":\n\t\t\treturn <SelectWorkQueuesFields action=\"Resume\" index={index} />;\n\t\tcase \"pause-work-pool\":\n\t\t\treturn <SelectWorkPoolsFields action=\"Pause\" index={index} />;\n\t\tcase \"resume-work-pool\":\n\t\t\treturn <SelectWorkPoolsFields action=\"Resume\" index={index} />;\n\t\tcase \"pause-automation\":\n\t\t\treturn <SelectAutomationsFields action=\"Pause\" index={index} />;\n\t\tcase \"resume-automation\":\n\t\t\treturn <SelectAutomationsFields action=\"Resume\" index={index} />;\n\t\tcase \"send-notification\":\n\t\t\treturn <SendNotificationFields index={index} />;\n\t\tcase \"cancel-flow-run\":\n\t\t\treturn <FlowRunActionDescription action=\"Cancel\" />;\n\t\tcase \"suspend-flow-run\":\n\t\t\treturn <FlowRunActionDescription action=\"Suspend\" />;\n\t\tcase \"resume-flow-run\":\n\t\t\treturn <FlowRunActionDescription action=\"Resume\" />;\n\t\tdefault:\n\t\t\treturn null;\n\t}\n};\n","import { useFieldArray, useFormContext } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Icon } from \"@/components/ui/icons\";\nimport { ActionStep } from \"./action-step\";\n\nexport const ActionsStep = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst { fields, append, remove } = useFieldArray({\n\t\tcontrol: form.control,\n\t\tname: \"actions\",\n\t\tshouldUnregister: false,\n\t\trules: { minLength: 1 },\n\t});\n\n\treturn (\n\t\t<div>\n\t\t\t{fields.map(({ id }, index) => (\n\t\t\t\t<ActionStep key={id} index={index} onRemove={() => remove(index)} />\n\t\t\t))}\n\t\t\t<Button\n\t\t\t\ttype=\"button\"\n\t\t\t\tvariant=\"outline\"\n\t\t\t\tonClick={() => append({ type: \"cancel-flow-run\" })}\n\t\t\t>\n\t\t\t\t<Icon id=\"Plus\" className=\"mr-2 size-4\" /> Add Action\n\t\t\t</Button>\n\t\t</div>\n\t);\n};\n","import { useFormContext } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\n\nexport const DetailsStep = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\n\treturn (\n\t\t<div className=\"flex flex-col gap-4\">\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname=\"name\"\n\t\t\t\trender={({ field }) => (\n\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t<FormLabel>Automation Name</FormLabel>\n\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t<Input type=\"text\" {...field} value={field.value ?? \"\"} />\n\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t)}\n\t\t\t/>\n\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname=\"description\"\n\t\t\t\trender={({ field }) => (\n\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t<FormLabel>Description (Optional)</FormLabel>\n\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t<Input type=\"text\" {...field} value={field.value ?? \"\"} />\n\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t</FormItem>\n\t\t\t\t)}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n","import { useFormContext } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { FormControl, FormField, FormItem } from \"@/components/ui/form\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\n\nconst POSTURE_OPTIONS = [\n\t{ value: \"Reactive\", label: \"Enters\" },\n\t{ value: \"Proactive\", label: \"Stays in\" },\n] as const;\n\nconst DEFAULT_PROACTIVE_WITHIN = 30;\n\nexport const PostureSelect = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\n\treturn (\n\t\t<FormField\n\t\t\tcontrol={form.control}\n\t\t\tname=\"trigger.posture\"\n\t\t\trender={({ field }) => (\n\t\t\t\t<FormItem>\n\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\tvalue={field.value}\n\t\t\t\t\t\t\tonValueChange={(value: \"Reactive\" | \"Proactive\") => {\n\t\t\t\t\t\t\t\tconst previousPosture = field.value;\n\t\t\t\t\t\t\t\tfield.onChange(value);\n\n\t\t\t\t\t\t\t\t// Move state values between expect and after when posture changes\n\t\t\t\t\t\t\t\t// Reactive uses \"expect\", Proactive uses \"after\"\n\t\t\t\t\t\t\t\tif (previousPosture === \"Reactive\" && value === \"Proactive\") {\n\t\t\t\t\t\t\t\t\t// Moving from Reactive to Proactive: move expect to after\n\t\t\t\t\t\t\t\t\tconst expectValues = form.getValues(\"trigger.expect\") ?? [];\n\t\t\t\t\t\t\t\t\tform.setValue(\"trigger.after\", expectValues);\n\t\t\t\t\t\t\t\t\tform.setValue(\"trigger.expect\", []);\n\t\t\t\t\t\t\t\t\t// Set a default within value if it's 0\n\t\t\t\t\t\t\t\t\tconst currentWithin = form.getValues(\"trigger.within\");\n\t\t\t\t\t\t\t\t\tif (currentWithin === 0) {\n\t\t\t\t\t\t\t\t\t\tform.setValue(\"trigger.within\", DEFAULT_PROACTIVE_WITHIN);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\t\tpreviousPosture === \"Proactive\" &&\n\t\t\t\t\t\t\t\t\tvalue === \"Reactive\"\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t// Moving from Proactive to Reactive: move after to expect\n\t\t\t\t\t\t\t\t\tconst afterValues = form.getValues(\"trigger.after\") ?? [];\n\t\t\t\t\t\t\t\t\tform.setValue(\"trigger.expect\", afterValues);\n\t\t\t\t\t\t\t\t\tform.setValue(\"trigger.after\", []);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<SelectTrigger aria-label=\"select posture\" className=\"w-[160px]\">\n\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select posture\" />\n\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t{POSTURE_OPTIONS.map((option) => (\n\t\t\t\t\t\t\t\t\t<SelectItem key={option.value} value={option.value}>\n\t\t\t\t\t\t\t\t\t\t{option.label}\n\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t</Select>\n\t\t\t\t\t</FormControl>\n\t\t\t\t</FormItem>\n\t\t\t)}\n\t\t/>\n\t);\n};\n","import { useFormContext, useWatch } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { PostureSelect } from \"./posture-select\";\n\nexport const CustomTriggerFields = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst posture = useWatch<AutomationWizardSchema>({ name: \"trigger.posture\" });\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<div className=\"flex items-end gap-4\">\n\t\t\t\t<PostureSelect />\n\t\t\t</div>\n\n\t\t\t<FormField\n\t\t\t\tcontrol={form.control}\n\t\t\t\tname=\"trigger.expect\"\n\t\t\t\trender={({ field }) => {\n\t\t\t\t\tconst events = field.value ?? [];\n\t\t\t\t\tconst textValue = events.join(\"\\n\");\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t\t<FormLabel>Expected Events (one per line)</FormLabel>\n\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t<Textarea\n\t\t\t\t\t\t\t\t\tplaceholder=\"prefect.flow-run.Completed\"\n\t\t\t\t\t\t\t\t\tvalue={textValue}\n\t\t\t\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\t\t\t\tconst lines = e.target.value\n\t\t\t\t\t\t\t\t\t\t\t.split(\"\\n\")\n\t\t\t\t\t\t\t\t\t\t\t.filter((line) => line.trim() !== \"\");\n\t\t\t\t\t\t\t\t\t\tfield.onChange(lines.length > 0 ? lines : undefined);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\trows={4}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t/>\n\n\t\t\t<div className=\"flex gap-4\">\n\t\t\t\t<FormField\n\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\tname=\"trigger.threshold\"\n\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t<FormItem className=\"w-32\">\n\t\t\t\t\t\t\t<FormLabel>Threshold</FormLabel>\n\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tmin={1}\n\t\t\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\t\t\tonChange={(e) => field.onChange(Number(e.target.value))}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\n\t\t\t\t{posture === \"Proactive\" && (\n\t\t\t\t\t<FormField\n\t\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\t\tname=\"trigger.within\"\n\t\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t\t<FormItem className=\"w-32\">\n\t\t\t\t\t\t\t\t<FormLabel>Within (seconds)</FormLabel>\n\t\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => field.onChange(Number(e.target.value))}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t\t)}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import { useFormContext, useWatch } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { PostureSelect } from \"./posture-select\";\n\nconst DEPLOYMENT_STATUSES = [\n\t{ value: \"prefect.deployment.ready\", label: \"Ready\" },\n\t{ value: \"prefect.deployment.not-ready\", label: \"Not Ready\" },\n];\n\nexport const DeploymentStatusTriggerFields = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst posture = useWatch<AutomationWizardSchema>({ name: \"trigger.posture\" });\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<div className=\"flex items-end gap-4\">\n\t\t\t\t<PostureSelect />\n\t\t\t\t<FormField\n\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\tname=\"trigger.expect\"\n\t\t\t\t\trender={({ field }) => {\n\t\t\t\t\t\tconst selectedStatus = field.value?.[0];\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<FormItem className=\"flex-1\">\n\t\t\t\t\t\t\t\t<FormLabel>Status</FormLabel>\n\t\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\t\t\tvalue={selectedStatus ?? \"\"}\n\t\t\t\t\t\t\t\t\t\tonValueChange={(value) => field.onChange([value])}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<SelectTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select status\" />\n\t\t\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t\t\t{DEPLOYMENT_STATUSES.map((status) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<SelectItem key={status.value} value={status.value}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{status.label}\n\t\t\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t\t);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div className=\"flex gap-4\">\n\t\t\t\t<FormField\n\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\tname=\"trigger.threshold\"\n\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t<FormItem className=\"w-32\">\n\t\t\t\t\t\t\t<FormLabel>Threshold</FormLabel>\n\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tmin={1}\n\t\t\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\t\t\tonChange={(e) => field.onChange(Number(e.target.value))}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\n\t\t\t\t{posture === \"Proactive\" && (\n\t\t\t\t\t<FormField\n\t\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\t\tname=\"trigger.within\"\n\t\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t\t<FormItem className=\"w-32\">\n\t\t\t\t\t\t\t\t<FormLabel>Within (seconds)</FormLabel>\n\t\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\t\t{...field}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => field.onChange(Number(e.target.value))}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t\t)}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { buildListFlowsQuery, type Flow } from \"@/api/flows\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\n\nconst MAX_VISIBLE_FLOWS = 2;\n\ntype FlowMultiSelectProps = {\n\tselectedFlowIds: string[];\n\tonToggleFlow: (flowId: string) => void;\n\temptyMessage?: string;\n};\n\nexport function FlowMultiSelect({\n\tselectedFlowIds,\n\tonToggleFlow,\n\temptyMessage = \"Any flow\",\n}: FlowMultiSelectProps) {\n\tconst [search, setSearch] = useState(\"\");\n\tconst deferredSearch = useDeferredValue(search);\n\n\tconst { data: flows = [] } = useQuery(\n\t\tbuildListFlowsQuery({\n\t\t\tflows: deferredSearch\n\t\t\t\t? {\n\t\t\t\t\t\toperator: \"and_\",\n\t\t\t\t\t\tname: { like_: deferredSearch },\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t\tlimit: 100,\n\t\t\toffset: 0,\n\t\t\tsort: \"NAME_ASC\",\n\t\t}),\n\t);\n\n\tconst { data: selectedFlowsData = [] } = useQuery(\n\t\tbuildListFlowsQuery(\n\t\t\t{\n\t\t\t\tflows:\n\t\t\t\t\tselectedFlowIds.length > 0\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\toperator: \"and_\",\n\t\t\t\t\t\t\t\tid: { any_: selectedFlowIds },\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: undefined,\n\t\t\t\tlimit: selectedFlowIds.length || 1,\n\t\t\t\toffset: 0,\n\t\t\t\tsort: \"NAME_ASC\",\n\t\t\t},\n\t\t\t{ enabled: selectedFlowIds.length > 0 },\n\t\t),\n\t);\n\n\tconst filteredFlows = useMemo(() => {\n\t\treturn flows.filter(\n\t\t\t(flow: Flow) =>\n\t\t\t\t!deferredSearch ||\n\t\t\t\tflow.name.toLowerCase().includes(deferredSearch.toLowerCase()),\n\t\t);\n\t}, [flows, deferredSearch]);\n\n\tconst renderSelectedFlows = () => {\n\t\tif (selectedFlowIds.length === 0) {\n\t\t\treturn <span className=\"text-muted-foreground\">{emptyMessage}</span>;\n\t\t}\n\n\t\tconst selectedFlowNames = selectedFlowsData\n\t\t\t.filter((flow) => selectedFlowIds.includes(flow.id))\n\t\t\t.map((flow) => flow.name);\n\n\t\tconst visibleNames = selectedFlowNames.slice(0, MAX_VISIBLE_FLOWS);\n\t\tconst overflow = selectedFlowIds.length - visibleNames.length;\n\n\t\treturn (\n\t\t\t<div className=\"flex min-w-0 items-center justify-start gap-1\">\n\t\t\t\t<span className=\"truncate min-w-0 text-left\">\n\t\t\t\t\t{visibleNames.join(\", \")}\n\t\t\t\t</span>\n\t\t\t\t{overflow > 0 && (\n\t\t\t\t\t<span className=\"shrink-0 text-muted-foreground\">+{overflow}</span>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Combobox>\n\t\t\t<ComboboxTrigger selected={selectedFlowIds.length > 0}>\n\t\t\t\t{renderSelectedFlows()}\n\t\t\t</ComboboxTrigger>\n\t\t\t<ComboboxContent>\n\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\tvalue={search}\n\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\tplaceholder=\"Search flows...\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t<ComboboxCommandEmtpy>No flows found</ComboboxCommandEmtpy>\n\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t{filteredFlows.map((flow: Flow) => (\n\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\tkey={flow.id}\n\t\t\t\t\t\t\t\tselected={selectedFlowIds.includes(flow.id)}\n\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\tonToggleFlow(flow.id);\n\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\tvalue={flow.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{flow.name}\n\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t</ComboboxCommandList>\n\t\t\t</ComboboxContent>\n\t\t</Combobox>\n\t);\n}\n","import { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { cn } from \"@/utils\";\n\nconst SECONDS_IN_MINUTE = 60;\nconst SECONDS_IN_HOUR = 3600;\nconst SECONDS_IN_DAY = 86400;\n\ntype DurationUnit = {\n\tlabel: string;\n\tvalue: number;\n};\n\nconst DURATION_UNITS: DurationUnit[] = [\n\t{ label: \"Seconds\", value: 1 },\n\t{ label: \"Minutes\", value: SECONDS_IN_MINUTE },\n\t{ label: \"Hours\", value: SECONDS_IN_HOUR },\n\t{ label: \"Days\", value: SECONDS_IN_DAY },\n];\n\nfunction getDefaultUnitForValue(value: number): number {\n\tif (value > 0 && value % SECONDS_IN_DAY === 0) {\n\t\treturn SECONDS_IN_DAY;\n\t}\n\tif (value > 0 && value % SECONDS_IN_HOUR === 0) {\n\t\treturn SECONDS_IN_HOUR;\n\t}\n\tif (value > 0 && value % SECONDS_IN_MINUTE === 0) {\n\t\treturn SECONDS_IN_MINUTE;\n\t}\n\treturn 1;\n}\n\nexport type DurationInputProps = {\n\tvalue: number;\n\tonChange: (seconds: number) => void;\n\tmin?: number;\n\tclassName?: string;\n\tdisabled?: boolean;\n};\n\nexport function DurationInput({\n\tvalue,\n\tonChange,\n\tmin = 0,\n\tclassName,\n\tdisabled = false,\n}: DurationInputProps) {\n\tconst [unit, setUnit] = useState<number>(() => getDefaultUnitForValue(value));\n\n\tconst availableUnits = useMemo(() => {\n\t\treturn DURATION_UNITS.filter((u) => u.value >= min);\n\t}, [min]);\n\n\tconst quantity = useMemo(() => {\n\t\treturn value / unit;\n\t}, [value, unit]);\n\n\tconst handleQuantityChange = useCallback(\n\t\t(newQuantity: number) => {\n\t\t\tonChange(newQuantity * unit);\n\t\t},\n\t\t[onChange, unit],\n\t);\n\n\tconst handleUnitChange = useCallback(\n\t\t(newUnitValue: string) => {\n\t\t\tconst newUnit = Number(newUnitValue);\n\t\t\tconst oldUnit = unit;\n\t\t\tsetUnit(newUnit);\n\t\t\tonChange((value / oldUnit) * newUnit);\n\t\t},\n\t\t[onChange, unit, value],\n\t);\n\n\tuseEffect(() => {\n\t\tif (!availableUnits.some((u) => u.value === unit)) {\n\t\t\tconst firstAvailable = availableUnits[0];\n\t\t\tif (firstAvailable) {\n\t\t\t\tsetUnit(firstAvailable.value);\n\t\t\t}\n\t\t}\n\t}, [availableUnits, unit]);\n\n\treturn (\n\t\t<div className={cn(\"grid grid-cols-[1fr_7rem] gap-2 w-full\", className)}>\n\t\t\t<Input\n\t\t\t\ttype=\"number\"\n\t\t\t\tmin={0}\n\t\t\t\tvalue={quantity}\n\t\t\t\tonChange={(e) => handleQuantityChange(Number(e.target.value))}\n\t\t\t\tdisabled={disabled}\n\t\t\t\taria-label=\"Duration quantity\"\n\t\t\t/>\n\t\t\t<Select\n\t\t\t\tvalue={String(unit)}\n\t\t\t\tonValueChange={handleUnitChange}\n\t\t\t\tdisabled={disabled}\n\t\t\t>\n\t\t\t\t<SelectTrigger aria-label=\"Duration unit\">\n\t\t\t\t\t<SelectValue />\n\t\t\t\t</SelectTrigger>\n\t\t\t\t<SelectContent>\n\t\t\t\t\t{availableUnits.map((u) => (\n\t\t\t\t\t\t<SelectItem key={u.value} value={String(u.value)}>\n\t\t\t\t\t\t\t{u.label}\n\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t))}\n\t\t\t\t</SelectContent>\n\t\t\t</Select>\n\t\t</div>\n\t);\n}\n","import { useDeferredValue, useMemo, useState } from \"react\";\nimport {\n\tSTATE_NAME_TO_TYPE,\n\tSTATE_NAMES,\n\tSTATE_NAMES_WITHOUT_SCHEDULED,\n\ttype StateName,\n} from \"@/api/flow-runs/constants\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\nimport { StateBadge } from \"@/components/ui/state-badge\";\n\nconst ALL_RUN_STATES = \"All run states\";\nconst ALL_EXCEPT_SCHEDULED = \"All except scheduled\";\n\ntype StateMultiSelectProps = {\n\tselectedStates: StateName[];\n\tonStateChange: (states: StateName[]) => void;\n\temptyMessage?: string;\n};\n\nfunction isAllExceptScheduled(states: StateName[]): boolean {\n\tif (states.length !== STATE_NAMES.length - 1) return false;\n\treturn !states.includes(\"Scheduled\");\n}\n\nexport function StateMultiSelect({\n\tselectedStates,\n\tonStateChange,\n\temptyMessage = \"Any state\",\n}: StateMultiSelectProps) {\n\tconst [search, setSearch] = useState(\"\");\n\tconst deferredSearch = useDeferredValue(search);\n\n\tconst displayValue = useMemo(() => {\n\t\tif (selectedStates.length === 0) {\n\t\t\treturn ALL_RUN_STATES;\n\t\t}\n\t\tif (isAllExceptScheduled(selectedStates)) {\n\t\t\treturn ALL_EXCEPT_SCHEDULED;\n\t\t}\n\t\treturn selectedStates;\n\t}, [selectedStates]);\n\n\tconst filteredStates = useMemo(() => {\n\t\tconst lowerSearch = deferredSearch.toLowerCase();\n\t\treturn STATE_NAMES.filter((name) =>\n\t\t\tname.toLowerCase().includes(lowerSearch),\n\t\t);\n\t}, [deferredSearch]);\n\n\tconst showConvenienceOptions = useMemo(() => {\n\t\tconst lowerSearch = deferredSearch.toLowerCase();\n\t\treturn (\n\t\t\tALL_RUN_STATES.toLowerCase().includes(lowerSearch) ||\n\t\t\tALL_EXCEPT_SCHEDULED.toLowerCase().includes(lowerSearch)\n\t\t);\n\t}, [deferredSearch]);\n\n\tconst handleConvenienceSelect = (option: string) => {\n\t\tif (option === ALL_RUN_STATES) {\n\t\t\tonStateChange([]);\n\t\t} else if (option === ALL_EXCEPT_SCHEDULED) {\n\t\t\tonStateChange([...STATE_NAMES_WITHOUT_SCHEDULED]);\n\t\t}\n\t\tsetSearch(\"\");\n\t};\n\n\tconst handleStateToggle = (stateName: StateName) => {\n\t\tif (selectedStates.includes(stateName)) {\n\t\t\tonStateChange(selectedStates.filter((s) => s !== stateName));\n\t\t} else {\n\t\t\tonStateChange([...selectedStates, stateName]);\n\t\t}\n\t\tsetSearch(\"\");\n\t};\n\n\tconst renderSelectedStates = () => {\n\t\tif (displayValue === ALL_RUN_STATES) {\n\t\t\treturn <span className=\"text-muted-foreground\">{emptyMessage}</span>;\n\t\t}\n\t\tif (displayValue === ALL_EXCEPT_SCHEDULED) {\n\t\t\treturn <span>All except scheduled</span>;\n\t\t}\n\t\treturn (\n\t\t\t<div className=\"flex flex-wrap gap-1\">\n\t\t\t\t{selectedStates.map((stateName) => (\n\t\t\t\t\t<StateBadge\n\t\t\t\t\t\tkey={stateName}\n\t\t\t\t\t\ttype={STATE_NAME_TO_TYPE[stateName]}\n\t\t\t\t\t\tname={stateName}\n\t\t\t\t\t\tclassName=\"cursor-pointer\"\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Combobox>\n\t\t\t<ComboboxTrigger selected={selectedStates.length > 0}>\n\t\t\t\t{renderSelectedStates()}\n\t\t\t</ComboboxTrigger>\n\t\t\t<ComboboxContent>\n\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\tvalue={search}\n\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\tplaceholder=\"Search states...\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxCommandEmtpy>No state found</ComboboxCommandEmtpy>\n\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t{showConvenienceOptions && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\tkey={ALL_RUN_STATES}\n\t\t\t\t\t\t\t\t\tselected={displayValue === ALL_RUN_STATES}\n\t\t\t\t\t\t\t\t\tonSelect={() => handleConvenienceSelect(ALL_RUN_STATES)}\n\t\t\t\t\t\t\t\t\tvalue={ALL_RUN_STATES}\n\t\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tAll run states\n\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\tkey={ALL_EXCEPT_SCHEDULED}\n\t\t\t\t\t\t\t\t\tselected={displayValue === ALL_EXCEPT_SCHEDULED}\n\t\t\t\t\t\t\t\t\tonSelect={() => handleConvenienceSelect(ALL_EXCEPT_SCHEDULED)}\n\t\t\t\t\t\t\t\t\tvalue={ALL_EXCEPT_SCHEDULED}\n\t\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tAll except scheduled\n\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{filteredStates.map((stateName) => (\n\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\tkey={stateName}\n\t\t\t\t\t\t\t\tselected={selectedStates.includes(stateName)}\n\t\t\t\t\t\t\t\tonSelect={() => handleStateToggle(stateName)}\n\t\t\t\t\t\t\t\tvalue={stateName}\n\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<StateBadge\n\t\t\t\t\t\t\t\t\ttype={STATE_NAME_TO_TYPE[stateName]}\n\t\t\t\t\t\t\t\t\tname={stateName}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t</ComboboxCommandList>\n\t\t\t</ComboboxContent>\n\t\t</Combobox>\n\t);\n}\n","import { useFormContext, useWatch } from \"react-hook-form\";\nimport type { StateName } from \"@/api/flow-runs/constants\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { FlowMultiSelect } from \"@/components/flows/flow-multi-select\";\nimport { DurationInput } from \"@/components/ui/duration-input\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport { TagsInput } from \"@/components/ui/tags-input\";\nimport { PostureSelect } from \"./posture-select\";\nimport { StateMultiSelect } from \"./state-multi-select\";\n\ntype MatchRelated = Record<string, string | string[]> | undefined;\n\n// Convert state names to event strings (e.g., \"Completed\" -> \"prefect.flow-run.Completed\")\n// When no states selected, returns wildcard [\"prefect.flow-run.*\"] (Vue behavior)\nfunction toStateNameEvents(stateNames: StateName[]): string[] {\n\tif (stateNames.length === 0) {\n\t\treturn [\"prefect.flow-run.*\"];\n\t}\n\treturn stateNames.map((name) => `prefect.flow-run.${name}`);\n}\n\n// Convert event strings back to state names (e.g., \"prefect.flow-run.Completed\" -> \"Completed\")\n// Wildcard \"prefect.flow-run.*\" returns empty array (means \"any state\")\nfunction fromStateNameEvents(events: string[] | undefined): StateName[] {\n\tif (!events || events.length === 0) {\n\t\treturn [];\n\t}\n\tif (events.includes(\"prefect.flow-run.*\")) {\n\t\treturn [];\n\t}\n\treturn events\n\t\t.filter((event) => event.startsWith(\"prefect.flow-run.\"))\n\t\t.map((event) => event.replace(\"prefect.flow-run.\", \"\") as StateName);\n}\n\nfunction extractFlowIdsFromMatchRelated(matchRelated: MatchRelated): string[] {\n\tif (!matchRelated) return [];\n\n\tconst resourceIds = matchRelated[\"prefect.resource.id\"];\n\tif (!resourceIds) return [];\n\n\tconst ids = Array.isArray(resourceIds) ? resourceIds : [resourceIds];\n\treturn ids\n\t\t.filter((id) => id.startsWith(\"prefect.flow.\"))\n\t\t.map((id) => id.replace(\"prefect.flow.\", \"\"));\n}\n\nfunction extractTagsFromMatchRelated(matchRelated: MatchRelated): string[] {\n\tif (!matchRelated) return [];\n\n\tconst resourceIds = matchRelated[\"prefect.resource.id\"];\n\tif (!resourceIds) return [];\n\n\tconst ids = Array.isArray(resourceIds) ? resourceIds : [resourceIds];\n\treturn ids\n\t\t.filter((id) => id.startsWith(\"prefect.tag.\"))\n\t\t.map((id) => id.replace(\"prefect.tag.\", \"\"));\n}\n\nfunction buildMatchRelated(flowIds: string[], tags: string[]): MatchRelated {\n\tconst flowResourceIds = flowIds.map((id) => `prefect.flow.${id}`);\n\tconst tagResourceIds = tags.map((tag) => `prefect.tag.${tag}`);\n\n\t// Return empty object when no flows/tags selected (matches Vue behavior)\n\tif (flowResourceIds.length === 0 && tagResourceIds.length === 0) {\n\t\treturn {};\n\t}\n\n\t// Set role based on which type is selected (Vue behavior)\n\t// Since tags are hidden when flows are selected, only one type will be present\n\tconst role = flowResourceIds.length > 0 ? \"flow\" : \"tag\";\n\tconst resourceIds = [...flowResourceIds, ...tagResourceIds];\n\n\treturn {\n\t\t\"prefect.resource.role\": role,\n\t\t\"prefect.resource.id\": resourceIds,\n\t};\n}\n\nexport const FlowRunStateTriggerFields = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst posture = useWatch<AutomationWizardSchema>({ name: \"trigger.posture\" });\n\n\t// Determine which field to use based on posture\n\t// Reactive: use \"expect\" (states to enter)\n\t// Proactive: use \"after\" (states to stay in)\n\tconst stateFieldName =\n\t\tposture === \"Proactive\" ? \"trigger.after\" : \"trigger.expect\";\n\n\tconst matchRelated = useWatch<AutomationWizardSchema>({\n\t\tname: \"trigger.match_related\",\n\t}) as MatchRelated;\n\n\tconst selectedFlowIds = extractFlowIdsFromMatchRelated(matchRelated);\n\tconst selectedTags = extractTagsFromMatchRelated(matchRelated);\n\n\tconst handleFlowToggle = (flowId: string) => {\n\t\tconst currentFlowIds = selectedFlowIds;\n\t\tconst newFlowIds = currentFlowIds.includes(flowId)\n\t\t\t? currentFlowIds.filter((id) => id !== flowId)\n\t\t\t: [...currentFlowIds, flowId];\n\n\t\t// Clear tags when flows are selected (Vue behavior)\n\t\tconst newTags = newFlowIds.length > 0 ? [] : selectedTags;\n\t\tform.setValue(\n\t\t\t\"trigger.match_related\",\n\t\t\tbuildMatchRelated(newFlowIds, newTags),\n\t\t);\n\t};\n\n\tconst handleTagsChange = (tags: string[]) => {\n\t\tform.setValue(\n\t\t\t\"trigger.match_related\",\n\t\t\tbuildMatchRelated(selectedFlowIds, tags),\n\t\t);\n\t};\n\n\t// Hide tags input when flows are selected (Vue behavior)\n\tconst showTagsInput = selectedFlowIds.length === 0;\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<FormItem>\n\t\t\t\t<FormLabel>Flows</FormLabel>\n\t\t\t\t<FormControl>\n\t\t\t\t\t<FlowMultiSelect\n\t\t\t\t\t\tselectedFlowIds={selectedFlowIds}\n\t\t\t\t\t\tonToggleFlow={handleFlowToggle}\n\t\t\t\t\t\temptyMessage=\"All flows\"\n\t\t\t\t\t/>\n\t\t\t\t</FormControl>\n\t\t\t</FormItem>\n\n\t\t\t{showTagsInput && (\n\t\t\t\t<FormItem>\n\t\t\t\t\t<FormLabel>Flow Run Tags</FormLabel>\n\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t<TagsInput\n\t\t\t\t\t\t\tvalue={selectedTags}\n\t\t\t\t\t\t\tonChange={handleTagsChange}\n\t\t\t\t\t\t\tplaceholder=\"All tags\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FormControl>\n\t\t\t\t</FormItem>\n\t\t\t)}\n\n\t\t\t<FormItem>\n\t\t\t\t<FormLabel>Flow Run</FormLabel>\n\t\t\t\t<div className=\"grid grid-cols-[10rem_1fr] gap-2\">\n\t\t\t\t\t<PostureSelect />\n\t\t\t\t\t<FormField\n\t\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\t\tname={stateFieldName}\n\t\t\t\t\t\trender={({ field }) => {\n\t\t\t\t\t\t\t// Convert event strings to state names for UI display\n\t\t\t\t\t\t\tconst eventStrings = field.value ?? [];\n\t\t\t\t\t\t\tconst selectedStates = fromStateNameEvents(eventStrings);\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t\t<StateMultiSelect\n\t\t\t\t\t\t\t\t\t\tselectedStates={selectedStates}\n\t\t\t\t\t\t\t\t\t\tonStateChange={(states) => {\n\t\t\t\t\t\t\t\t\t\t\t// Convert state names to event strings for storage\n\t\t\t\t\t\t\t\t\t\t\tfield.onChange(toStateNameEvents(states));\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\temptyMessage=\"Any state\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</FormItem>\n\n\t\t\t{posture === \"Proactive\" && (\n\t\t\t\t<FormField\n\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\tname=\"trigger.within\"\n\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t\t<FormLabel>For</FormLabel>\n\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t<DurationInput\n\t\t\t\t\t\t\t\t\tvalue={field.value ?? 0}\n\t\t\t\t\t\t\t\t\tonChange={field.onChange}\n\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import type { ReactNode } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nexport type FormMode = \"Form\" | \"JSON\";\n\ntype FormModeToggleProps = {\n\tdefaultValue?: FormMode;\n\t/** Controlled value - when provided, the component becomes controlled */\n\tvalue?: FormMode;\n\t/** Callback when the mode changes - required for controlled mode */\n\tonValueChange?: (value: FormMode) => void;\n\tformContent: ReactNode;\n\tjsonContent: ReactNode;\n};\n\nexport const FormModeToggle = ({\n\tdefaultValue = \"Form\",\n\tvalue,\n\tonValueChange,\n\tformContent,\n\tjsonContent,\n}: FormModeToggleProps) => {\n\t// When value is provided, use controlled mode; otherwise use uncontrolled mode\n\tconst tabsProps =\n\t\tvalue !== undefined\n\t\t\t? { value, onValueChange: onValueChange as (value: string) => void }\n\t\t\t: { defaultValue };\n\n\treturn (\n\t\t<Tabs {...tabsProps}>\n\t\t\t<div className=\"flex justify-center\">\n\t\t\t\t<TabsList>\n\t\t\t\t\t<TabsTrigger value=\"Form\">Form</TabsTrigger>\n\t\t\t\t\t<TabsTrigger value=\"JSON\">JSON</TabsTrigger>\n\t\t\t\t</TabsList>\n\t\t\t</div>\n\t\t\t<TabsContent value=\"Form\">{formContent}</TabsContent>\n\t\t\t<TabsContent value=\"JSON\">{jsonContent}</TabsContent>\n\t\t</Tabs>\n\t);\n};\n","import { useState } from \"react\";\nimport { z } from \"zod\";\nimport { TriggerSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { JsonInput, type JsonInputOnChange } from \"@/components/ui/json-input\";\nimport { Label } from \"@/components/ui/label\";\n\ntype TriggerJsonInputProps = {\n\tvalue: string;\n\tonChange: (value: string) => void;\n\terror?: string;\n};\n\nexport const TriggerJsonInput = ({\n\tvalue,\n\tonChange,\n\terror,\n}: TriggerJsonInputProps) => {\n\tconst [localError, setLocalError] = useState<string | null>(null);\n\n\tconst formatJson = () => {\n\t\ttry {\n\t\t\tconst parsed: unknown = JSON.parse(value);\n\t\t\tonChange(JSON.stringify(parsed, null, 2));\n\t\t} catch {\n\t\t\t// Invalid JSON, do nothing\n\t\t}\n\t};\n\n\tconst validate = (json: string): boolean => {\n\t\ttry {\n\t\t\tconst parsed: unknown = JSON.parse(json);\n\t\t\tTriggerSchema.parse(parsed);\n\t\t\tsetLocalError(null);\n\t\t\treturn true;\n\t\t} catch (e) {\n\t\t\tif (e instanceof SyntaxError) {\n\t\t\t\tsetLocalError(\"Invalid JSON syntax\");\n\t\t\t} else if (e instanceof z.ZodError) {\n\t\t\t\tsetLocalError(e.errors[0]?.message ?? \"Invalid trigger configuration\");\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-2\">\n\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t<Label>Trigger Configuration</Label>\n\t\t\t\t<Button variant=\"ghost\" size=\"sm\" onClick={formatJson}>\n\t\t\t\t\tFormat\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t\t<p className=\"text-sm text-muted-foreground\">\n\t\t\t\tEdit the trigger configuration as JSON.{\" \"}\n\t\t\t\t<a\n\t\t\t\t\thref=\"https://docs.prefect.io/v3/automate/events/automations-triggers\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\tclassName=\"underline hover:text-foreground\"\n\t\t\t\t>\n\t\t\t\t\tView documentation\n\t\t\t\t</a>\n\t\t\t</p>\n\t\t\t<JsonInput\n\t\t\t\tvalue={value}\n\t\t\t\tonChange={onChange as JsonInputOnChange}\n\t\t\t\tonBlur={() => validate(value)}\n\t\t\t/>\n\t\t\t{(localError || error) && (\n\t\t\t\t<p className=\"text-sm text-destructive\">{localError || error}</p>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import { useFormContext } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { FormControl, FormField, FormItem } from \"@/components/ui/form\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectGroup,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\n\nconst TEMPLATE_TRIGGERS = {\n\t\"deployment-status\": \"Deployment status\",\n\t\"flow-run-state\": \"Flow run state\",\n\t\"work-pool-status\": \"Work pool status\",\n\t\"work-queue-status\": \"Work queue status\",\n\tcustom: \"Custom\",\n} as const;\n\nexport type TemplateTriggers = keyof typeof TEMPLATE_TRIGGERS;\n\n// Type alias for consistency with ticket specification\nexport type TriggerTemplate = TemplateTriggers;\n\ntype AutomationsTriggerTemplateSelectProps = {\n\tonValueChange: (value: TemplateTriggers) => void;\n\tvalue?: TemplateTriggers;\n};\n\nexport const AutomationsTriggerTemplateSelect = ({\n\tonValueChange,\n\tvalue,\n}: AutomationsTriggerTemplateSelectProps) => {\n\treturn (\n\t\t<div className=\"space-y-2\">\n\t\t\t<Label htmlFor=\"automations-trigger-template-select\">\n\t\t\t\tTrigger Template\n\t\t\t</Label>\n\t\t\t<Select value={value} onValueChange={onValueChange}>\n\t\t\t\t<SelectTrigger\n\t\t\t\t\tid=\"automations-trigger-template-select\"\n\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t>\n\t\t\t\t\t<SelectValue placeholder=\"Select template\" />\n\t\t\t\t</SelectTrigger>\n\t\t\t\t<SelectContent>\n\t\t\t\t\t<SelectGroup>\n\t\t\t\t\t\t{Object.keys(TEMPLATE_TRIGGERS).map((key) => (\n\t\t\t\t\t\t\t<SelectItem key={key} value={key}>\n\t\t\t\t\t\t\t\t{TEMPLATE_TRIGGERS[key as TemplateTriggers]}\n\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</SelectGroup>\n\t\t\t\t</SelectContent>\n\t\t\t</Select>\n\t\t</div>\n\t);\n};\n\ntype TriggerTemplateSelectFieldProps = {\n\tonTemplateChange?: (template: TriggerTemplate) => void;\n};\n\nexport const TriggerTemplateSelectField = ({\n\tonTemplateChange,\n}: TriggerTemplateSelectFieldProps) => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\n\treturn (\n\t\t<FormField\n\t\t\tcontrol={form.control}\n\t\t\tname=\"triggerTemplate\"\n\t\t\trender={({ field }) => (\n\t\t\t\t<FormItem>\n\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t<AutomationsTriggerTemplateSelect\n\t\t\t\t\t\t\tvalue={field.value}\n\t\t\t\t\t\t\tonValueChange={(value) => {\n\t\t\t\t\t\t\t\tfield.onChange(value);\n\t\t\t\t\t\t\t\tonTemplateChange?.(value);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</FormControl>\n\t\t\t\t</FormItem>\n\t\t\t)}\n\t\t/>\n\t);\n};\n","import type { EventTrigger } from \"@/components/automations/automations-wizard/automation-schema\";\nimport type { TriggerTemplate } from \"@/components/automations/automations-wizard/automations-trigger-template-select\";\n\nconst BASE_TRIGGER: EventTrigger = {\n\ttype: \"event\",\n\tposture: \"Reactive\",\n\tthreshold: 1,\n\twithin: 0,\n};\n\nexport const getDefaultTriggerForTemplate = (\n\ttemplate: TriggerTemplate,\n): EventTrigger => {\n\tswitch (template) {\n\t\tcase \"flow-run-state\":\n\t\t\t// Return fields in same order as Vue for JSON tab visual parity\n\t\t\treturn {\n\t\t\t\ttype: \"event\",\n\t\t\t\tmatch: { \"prefect.resource.id\": \"prefect.flow-run.*\" },\n\t\t\t\tmatch_related: {},\n\t\t\t\tafter: [],\n\t\t\t\texpect: [\"prefect.flow-run.*\"],\n\t\t\t\tfor_each: [\"prefect.resource.id\"],\n\t\t\t\tposture: \"Reactive\",\n\t\t\t\tthreshold: 1,\n\t\t\t\twithin: 0,\n\t\t\t};\n\t\tcase \"deployment-status\":\n\t\t\treturn {\n\t\t\t\t...BASE_TRIGGER,\n\t\t\t\tmatch: { \"prefect.resource.id\": \"prefect.deployment.*\" },\n\t\t\t\tfor_each: [\"prefect.resource.id\"],\n\t\t\t};\n\t\tcase \"work-pool-status\":\n\t\t\t// Return fields in same order as Vue for JSON tab visual parity\n\t\t\treturn {\n\t\t\t\ttype: \"event\",\n\t\t\t\tmatch: { \"prefect.resource.id\": \"prefect.work-pool.*\" },\n\t\t\t\tmatch_related: {},\n\t\t\t\tafter: [],\n\t\t\t\texpect: [\n\t\t\t\t\t\"prefect.work-pool.not-ready\",\n\t\t\t\t\t// compatibility with old event name\n\t\t\t\t\t\"prefect.work-pool.not_ready\",\n\t\t\t\t],\n\t\t\t\tfor_each: [\"prefect.resource.id\"],\n\t\t\t\tposture: \"Reactive\",\n\t\t\t\tthreshold: 1,\n\t\t\t\twithin: 0,\n\t\t\t};\n\t\tcase \"work-queue-status\":\n\t\t\t// Return fields in same order as Vue for JSON tab visual parity\n\t\t\treturn {\n\t\t\t\ttype: \"event\",\n\t\t\t\tmatch: { \"prefect.resource.id\": \"prefect.work-queue.*\" },\n\t\t\t\tmatch_related: {},\n\t\t\t\tafter: [],\n\t\t\t\texpect: [\"prefect.work-queue.not-ready\"],\n\t\t\t\tfor_each: [\"prefect.resource.id\"],\n\t\t\t\tposture: \"Reactive\",\n\t\t\t\tthreshold: 1,\n\t\t\t\twithin: 0,\n\t\t\t};\n\t\tcase \"custom\":\n\t\t\treturn BASE_TRIGGER;\n\t\tdefault:\n\t\t\treturn BASE_TRIGGER;\n\t}\n};\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { buildFilterWorkPoolsQuery, type WorkPool } from \"@/api/work-pools\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\n\n// Show all selected work pool names and let CSS truncation handle overflow\n\ntype WorkPoolMultiSelectProps = {\n\tselectedWorkPoolIds: string[];\n\tonToggleWorkPool: (workPoolId: string) => void;\n\temptyMessage?: string;\n};\n\nexport function WorkPoolMultiSelect({\n\tselectedWorkPoolIds,\n\tonToggleWorkPool,\n\temptyMessage = \"All work pools\",\n}: WorkPoolMultiSelectProps) {\n\tconst [search, setSearch] = useState(\"\");\n\tconst deferredSearch = useDeferredValue(search);\n\n\tconst { data: workPools = [] } = useQuery(buildFilterWorkPoolsQuery());\n\n\t// Filter to only show work pools with a status (excluding push/agent pools)\n\t// and apply search filter\n\tconst filteredWorkPools = useMemo(() => {\n\t\treturn workPools\n\t\t\t.filter((workPool: WorkPool) => workPool.status !== null)\n\t\t\t.filter(\n\t\t\t\t(workPool: WorkPool) =>\n\t\t\t\t\t!deferredSearch ||\n\t\t\t\t\tworkPool.name.toLowerCase().includes(deferredSearch.toLowerCase()),\n\t\t\t);\n\t}, [workPools, deferredSearch]);\n\n\t// Get selected work pools data for display\n\tconst selectedWorkPoolsData = useMemo(() => {\n\t\treturn workPools.filter((workPool: WorkPool) =>\n\t\t\tselectedWorkPoolIds.includes(workPool.id),\n\t\t);\n\t}, [workPools, selectedWorkPoolIds]);\n\n\tconst renderSelectedWorkPools = () => {\n\t\tif (selectedWorkPoolIds.length === 0) {\n\t\t\treturn <span className=\"text-muted-foreground\">{emptyMessage}</span>;\n\t\t}\n\n\t\tconst selectedWorkPoolNames = selectedWorkPoolsData.map(\n\t\t\t(workPool) => workPool.name,\n\t\t);\n\n\t\t// Show all names and let CSS truncation handle overflow\n\t\treturn (\n\t\t\t<span className=\"truncate min-w-0 text-left\">\n\t\t\t\t{selectedWorkPoolNames.join(\", \")}\n\t\t\t</span>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Combobox>\n\t\t\t<ComboboxTrigger selected={selectedWorkPoolIds.length > 0}>\n\t\t\t\t{renderSelectedWorkPools()}\n\t\t\t</ComboboxTrigger>\n\t\t\t<ComboboxContent>\n\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\tvalue={search}\n\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\tplaceholder=\"Search work pools...\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t<ComboboxCommandEmtpy>No work pools found</ComboboxCommandEmtpy>\n\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t{filteredWorkPools.map((workPool: WorkPool) => (\n\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\tkey={workPool.id}\n\t\t\t\t\t\t\t\tselected={selectedWorkPoolIds.includes(workPool.id)}\n\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\tonToggleWorkPool(workPool.id);\n\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\tvalue={workPool.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{workPool.name}\n\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t</ComboboxCommandList>\n\t\t\t</ComboboxContent>\n\t\t</Combobox>\n\t);\n}\n","import { useFormContext, useWatch } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { DurationInput } from \"@/components/ui/duration-input\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { WorkPoolMultiSelect } from \"@/components/work-pools/work-pool-multi-select\";\nimport { PostureSelect } from \"./posture-select\";\n\n// Status options with their corresponding event arrays (matching Vue implementation)\n// \"not_ready\" maps to two events for backwards compatibility\nconst WORK_POOL_STATUSES = [\n\t{ value: \"ready\", label: \"Ready\", events: [\"prefect.work-pool.ready\"] },\n\t{\n\t\tvalue: \"not_ready\",\n\t\tlabel: \"Not Ready\",\n\t\tevents: [\"prefect.work-pool.not-ready\", \"prefect.work-pool.not_ready\"],\n\t},\n\t{ value: \"paused\", label: \"Paused\", events: [\"prefect.work-pool.paused\"] },\n] as const;\n\n// Get status value from events array (for reading from form state)\nfunction getStatusFromEvents(events: string[] | undefined): string {\n\tif (!events || events.length === 0) return \"not_ready\";\n\n\tfor (const status of WORK_POOL_STATUSES) {\n\t\tif (status.events.some((e) => events.includes(e))) {\n\t\t\treturn status.value;\n\t\t}\n\t}\n\treturn \"not_ready\";\n}\n\n// Get events for a status value\nfunction getEventsForStatus(statusValue: string): string[] {\n\tconst status = WORK_POOL_STATUSES.find((s) => s.value === statusValue);\n\treturn status ? [...status.events] : [];\n}\n\n// Get events for all statuses EXCEPT the given one (for Proactive expect)\nfunction getEventsExceptStatus(statusValue: string): string[] {\n\treturn WORK_POOL_STATUSES.filter((s) => s.value !== statusValue).flatMap(\n\t\t(s) => [...s.events],\n\t);\n}\n\ntype Match = Record<string, string | string[]> | undefined;\n\n// Extract work pool IDs from match['prefect.resource.id']\n// Returns empty array for wildcard \"prefect.work-pool.*\" (meaning \"all work pools\")\nfunction extractWorkPoolIdsFromMatch(match: Match): string[] {\n\tif (!match) return [];\n\n\tconst resourceIds = match[\"prefect.resource.id\"];\n\tif (!resourceIds) return [];\n\n\t// Handle wildcard case - \"all work pools\" means no specific pools selected\n\tif (resourceIds === \"prefect.work-pool.*\") return [];\n\n\tconst ids = Array.isArray(resourceIds) ? resourceIds : [resourceIds];\n\treturn ids\n\t\t.filter(\n\t\t\t(id) =>\n\t\t\t\tid.startsWith(\"prefect.work-pool.\") && id !== \"prefect.work-pool.*\",\n\t\t)\n\t\t.map((id) => id.replace(\"prefect.work-pool.\", \"\"));\n}\n\n// Build match object with work pool IDs\nfunction buildMatch(workPoolIds: string[]): Match {\n\tif (workPoolIds.length === 0) {\n\t\treturn {\n\t\t\t\"prefect.resource.id\": \"prefect.work-pool.*\",\n\t\t};\n\t}\n\n\treturn {\n\t\t\"prefect.resource.id\": workPoolIds.map((id) => `prefect.work-pool.${id}`),\n\t};\n}\n\n// Status select component that handles posture-dependent behavior\nconst StatusSelect = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst posture = useWatch<AutomationWizardSchema>({ name: \"trigger.posture\" });\n\tconst expect = useWatch<AutomationWizardSchema>({ name: \"trigger.expect\" }) as\n\t\t| string[]\n\t\t| undefined;\n\tconst after = useWatch<AutomationWizardSchema>({ name: \"trigger.after\" }) as\n\t\t| string[]\n\t\t| undefined;\n\n\t// Get current status based on posture\n\t// Reactive: status is in expect, Proactive: status is in after\n\tconst currentStatus =\n\t\tposture === \"Proactive\"\n\t\t\t? getStatusFromEvents(after)\n\t\t\t: getStatusFromEvents(expect);\n\n\tconst handleStatusChange = (statusValue: string) => {\n\t\tconst statusEvents = getEventsForStatus(statusValue);\n\t\tconst otherStatusEvents = getEventsExceptStatus(statusValue);\n\n\t\tif (posture === \"Proactive\") {\n\t\t\t// Proactive: selected status goes to \"after\", other statuses go to \"expect\"\n\t\t\tform.setValue(\"trigger.after\", statusEvents);\n\t\t\tform.setValue(\"trigger.expect\", otherStatusEvents);\n\t\t} else {\n\t\t\t// Reactive: selected status goes to \"expect\", \"after\" is empty\n\t\t\tform.setValue(\"trigger.expect\", statusEvents);\n\t\t\tform.setValue(\"trigger.after\", []);\n\t\t}\n\t};\n\n\treturn (\n\t\t<Select value={currentStatus} onValueChange={handleStatusChange}>\n\t\t\t<SelectTrigger aria-label=\"select status\" className=\"min-w-0 flex-1\">\n\t\t\t\t<SelectValue placeholder=\"Select status\" />\n\t\t\t</SelectTrigger>\n\t\t\t<SelectContent>\n\t\t\t\t{WORK_POOL_STATUSES.map((status) => (\n\t\t\t\t\t<SelectItem key={status.value} value={status.value}>\n\t\t\t\t\t\t{status.label}\n\t\t\t\t\t</SelectItem>\n\t\t\t\t))}\n\t\t\t</SelectContent>\n\t\t</Select>\n\t);\n};\n\nexport const WorkPoolStatusTriggerFields = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst posture = useWatch<AutomationWizardSchema>({ name: \"trigger.posture\" });\n\n\tconst match = useWatch<AutomationWizardSchema>({\n\t\tname: \"trigger.match\",\n\t}) as Match;\n\n\tconst selectedWorkPoolIds = extractWorkPoolIdsFromMatch(match);\n\n\tconst handleWorkPoolToggle = (workPoolId: string) => {\n\t\tconst currentWorkPoolIds = selectedWorkPoolIds;\n\t\tconst newWorkPoolIds = currentWorkPoolIds.includes(workPoolId)\n\t\t\t? currentWorkPoolIds.filter((id) => id !== workPoolId)\n\t\t\t: [...currentWorkPoolIds, workPoolId];\n\n\t\tform.setValue(\"trigger.match\", buildMatch(newWorkPoolIds));\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<FormItem>\n\t\t\t\t<FormLabel>Work Pools</FormLabel>\n\t\t\t\t<FormControl>\n\t\t\t\t\t<WorkPoolMultiSelect\n\t\t\t\t\t\tselectedWorkPoolIds={selectedWorkPoolIds}\n\t\t\t\t\t\tonToggleWorkPool={handleWorkPoolToggle}\n\t\t\t\t\t\temptyMessage=\"All work pools\"\n\t\t\t\t\t/>\n\t\t\t\t</FormControl>\n\t\t\t</FormItem>\n\n\t\t\t<FormItem>\n\t\t\t\t<FormLabel>Work Pool</FormLabel>\n\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t<PostureSelect />\n\t\t\t\t\t<StatusSelect />\n\t\t\t\t</div>\n\t\t\t</FormItem>\n\n\t\t\t{posture === \"Proactive\" && (\n\t\t\t\t<FormField\n\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\tname=\"trigger.within\"\n\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t\t<FormLabel>For</FormLabel>\n\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t<DurationInput\n\t\t\t\t\t\t\t\t\tvalue={field.value ?? 30}\n\t\t\t\t\t\t\t\t\tonChange={field.onChange}\n\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { buildFilterWorkPoolsQuery, type WorkPool } from \"@/api/work-pools\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\n\ntype WorkPoolsComboboxProps = {\n\tselectedWorkPoolIds: string[];\n\tonToggleWorkPool: (workPoolId: string) => void;\n\temptyMessage?: string;\n};\n\nexport function WorkPoolsCombobox({\n\tselectedWorkPoolIds,\n\tonToggleWorkPool,\n\temptyMessage = \"All work pools\",\n}: WorkPoolsComboboxProps) {\n\tconst [search, setSearch] = useState(\"\");\n\tconst deferredSearch = useDeferredValue(search);\n\n\tconst { data: workPools = [] } = useQuery(\n\t\tbuildFilterWorkPoolsQuery({\n\t\t\tlimit: 100,\n\t\t\toffset: 0,\n\t\t}),\n\t);\n\n\tconst filteredWorkPools = useMemo(() => {\n\t\treturn workPools.filter((workPool: WorkPool) => {\n\t\t\tif (!workPool.status) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!deferredSearch) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn workPool.name.toLowerCase().includes(deferredSearch.toLowerCase());\n\t\t});\n\t}, [workPools, deferredSearch]);\n\n\tconst renderSelectedWorkPools = () => {\n\t\tif (selectedWorkPoolIds.length === 0) {\n\t\t\treturn <span className=\"text-muted-foreground\">{emptyMessage}</span>;\n\t\t}\n\n\t\tconst selectedWorkPoolNames = workPools\n\t\t\t.filter((workPool) => selectedWorkPoolIds.includes(workPool.id))\n\t\t\t.map((workPool) => workPool.name);\n\n\t\treturn (\n\t\t\t<span className=\"truncate min-w-0 text-left\">\n\t\t\t\t{selectedWorkPoolNames.join(\", \")}\n\t\t\t</span>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Combobox>\n\t\t\t<ComboboxTrigger selected={selectedWorkPoolIds.length > 0}>\n\t\t\t\t{renderSelectedWorkPools()}\n\t\t\t</ComboboxTrigger>\n\t\t\t<ComboboxContent>\n\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\tvalue={search}\n\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\tplaceholder=\"Search work pools...\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t<ComboboxCommandEmtpy>No work pools found</ComboboxCommandEmtpy>\n\t\t\t\t\t<ComboboxCommandGroup>\n\t\t\t\t\t\t{filteredWorkPools.map((workPool: WorkPool) => (\n\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\tkey={workPool.id}\n\t\t\t\t\t\t\t\tselected={selectedWorkPoolIds.includes(workPool.id)}\n\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\tonToggleWorkPool(workPool.id);\n\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\tvalue={workPool.id}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{workPool.name}\n\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t</ComboboxCommandList>\n\t\t\t</ComboboxContent>\n\t\t</Combobox>\n\t);\n}\n","import { useQuery } from \"@tanstack/react-query\";\nimport { useDeferredValue, useMemo, useState } from \"react\";\nimport { buildFilterWorkQueuesQuery, type WorkQueue } from \"@/api/work-queues\";\nimport {\n\tCombobox,\n\tComboboxCommandEmtpy,\n\tComboboxCommandGroup,\n\tComboboxCommandInput,\n\tComboboxCommandItem,\n\tComboboxCommandList,\n\tComboboxContent,\n\tComboboxTrigger,\n} from \"@/components/ui/combobox\";\n\ntype WorkQueuesComboboxProps = {\n\tselectedWorkQueueIds: string[];\n\tonToggleWorkQueue: (workQueueId: string) => void;\n\tworkPoolIds?: string[];\n\temptyMessage?: string;\n};\n\nexport function WorkQueuesCombobox({\n\tselectedWorkQueueIds,\n\tonToggleWorkQueue,\n\tworkPoolIds = [],\n\temptyMessage = \"All work queues\",\n}: WorkQueuesComboboxProps) {\n\tconst [search, setSearch] = useState(\"\");\n\tconst deferredSearch = useDeferredValue(search);\n\n\tconst { data: workQueues = [] } = useQuery(\n\t\tbuildFilterWorkQueuesQuery({\n\t\t\tlimit: 100,\n\t\t\toffset: 0,\n\t\t}),\n\t);\n\n\tconst filteredWorkQueues = useMemo(() => {\n\t\treturn workQueues.filter((workQueue: WorkQueue) => {\n\t\t\t// Filter by work pool IDs if specified\n\t\t\tif (\n\t\t\t\tworkPoolIds.length > 0 &&\n\t\t\t\t(!workQueue.work_pool_id ||\n\t\t\t\t\t!workPoolIds.includes(workQueue.work_pool_id))\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!deferredSearch) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn workQueue.name\n\t\t\t\t.toLowerCase()\n\t\t\t\t.includes(deferredSearch.toLowerCase());\n\t\t});\n\t}, [workQueues, workPoolIds, deferredSearch]);\n\n\t// Group work queues by work pool name\n\tconst groupedWorkQueues = useMemo(() => {\n\t\tconst groups: Record<string, WorkQueue[]> = {};\n\n\t\tfor (const workQueue of filteredWorkQueues) {\n\t\t\tconst poolName = workQueue.work_pool_name ?? \"Unknown\";\n\t\t\tif (!groups[poolName]) {\n\t\t\t\tgroups[poolName] = [];\n\t\t\t}\n\t\t\tgroups[poolName].push(workQueue);\n\t\t}\n\n\t\t// Sort groups by pool name and sort queues within each group by name\n\t\tconst sortedGroupNames = Object.keys(groups).sort((a, b) =>\n\t\t\ta.localeCompare(b),\n\t\t);\n\n\t\treturn sortedGroupNames.map((poolName) => ({\n\t\t\tpoolName,\n\t\t\tqueues: groups[poolName].sort((a, b) => a.name.localeCompare(b.name)),\n\t\t}));\n\t}, [filteredWorkQueues]);\n\n\tconst renderSelectedWorkQueues = () => {\n\t\tif (selectedWorkQueueIds.length === 0) {\n\t\t\treturn <span className=\"text-muted-foreground\">{emptyMessage}</span>;\n\t\t}\n\n\t\tconst selectedWorkQueueNames = workQueues\n\t\t\t.filter((workQueue) => selectedWorkQueueIds.includes(workQueue.id))\n\t\t\t.map((workQueue) => workQueue.name);\n\n\t\treturn (\n\t\t\t<span className=\"truncate min-w-0 text-left\">\n\t\t\t\t{selectedWorkQueueNames.join(\", \")}\n\t\t\t</span>\n\t\t);\n\t};\n\n\treturn (\n\t\t<Combobox>\n\t\t\t<ComboboxTrigger selected={selectedWorkQueueIds.length > 0}>\n\t\t\t\t{renderSelectedWorkQueues()}\n\t\t\t</ComboboxTrigger>\n\t\t\t<ComboboxContent>\n\t\t\t\t<ComboboxCommandInput\n\t\t\t\t\tvalue={search}\n\t\t\t\t\tonValueChange={setSearch}\n\t\t\t\t\tplaceholder=\"Search work queues...\"\n\t\t\t\t/>\n\t\t\t\t<ComboboxCommandList>\n\t\t\t\t\t<ComboboxCommandEmtpy>No work queues found</ComboboxCommandEmtpy>\n\t\t\t\t\t{groupedWorkQueues.map((group) => (\n\t\t\t\t\t\t<ComboboxCommandGroup key={group.poolName} heading={group.poolName}>\n\t\t\t\t\t\t\t{group.queues.map((workQueue: WorkQueue) => (\n\t\t\t\t\t\t\t\t<ComboboxCommandItem\n\t\t\t\t\t\t\t\t\tkey={workQueue.id}\n\t\t\t\t\t\t\t\t\tselected={selectedWorkQueueIds.includes(workQueue.id)}\n\t\t\t\t\t\t\t\t\tonSelect={() => {\n\t\t\t\t\t\t\t\t\t\tonToggleWorkQueue(workQueue.id);\n\t\t\t\t\t\t\t\t\t\tsetSearch(\"\");\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tcloseOnSelect={false}\n\t\t\t\t\t\t\t\t\tvalue={workQueue.id}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{workQueue.name}\n\t\t\t\t\t\t\t\t</ComboboxCommandItem>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</ComboboxCommandGroup>\n\t\t\t\t\t))}\n\t\t\t\t</ComboboxCommandList>\n\t\t\t</ComboboxContent>\n\t\t</Combobox>\n\t);\n}\n","import { useFormContext, useWatch } from \"react-hook-form\";\nimport type { AutomationWizardSchema } from \"@/components/automations/automations-wizard/automation-schema\";\nimport { DurationInput } from \"@/components/ui/duration-input\";\nimport {\n\tFormControl,\n\tFormField,\n\tFormItem,\n\tFormLabel,\n\tFormMessage,\n} from \"@/components/ui/form\";\nimport {\n\tSelect,\n\tSelectContent,\n\tSelectItem,\n\tSelectTrigger,\n\tSelectValue,\n} from \"@/components/ui/select\";\nimport { PostureSelect } from \"./posture-select\";\nimport { WorkPoolsCombobox } from \"./work-pools-combobox\";\nimport { WorkQueuesCombobox } from \"./work-queues-combobox\";\n\nconst WORK_QUEUE_STATUSES = [\n\t{ value: \"prefect.work-queue.ready\", label: \"Ready\" },\n\t{ value: \"prefect.work-queue.not-ready\", label: \"Not Ready\" },\n\t{ value: \"prefect.work-queue.paused\", label: \"Paused\" },\n];\n\ntype MatchRelated = Record<string, string | string[]> | undefined;\ntype Match = Record<string, string | string[]> | undefined;\n\nfunction extractWorkPoolIdsFromMatchRelated(\n\tmatchRelated: MatchRelated,\n): string[] {\n\tif (!matchRelated) return [];\n\n\tconst resourceIds = matchRelated[\"prefect.resource.id\"];\n\tif (!resourceIds) return [];\n\n\tconst ids = Array.isArray(resourceIds) ? resourceIds : [resourceIds];\n\treturn ids\n\t\t.filter((id) => id.startsWith(\"prefect.work-pool.\"))\n\t\t.map((id) => id.replace(\"prefect.work-pool.\", \"\"));\n}\n\nfunction extractWorkQueueIdsFromMatch(match: Match): string[] {\n\tif (!match) return [];\n\n\tconst resourceIds = match[\"prefect.resource.id\"];\n\tif (!resourceIds) return [];\n\n\tconst ids = Array.isArray(resourceIds) ? resourceIds : [resourceIds];\n\n\tif (ids.includes(\"prefect.work-queue.*\")) {\n\t\treturn [];\n\t}\n\n\treturn ids\n\t\t.filter((id) => id.startsWith(\"prefect.work-queue.\"))\n\t\t.map((id) => id.replace(\"prefect.work-queue.\", \"\"));\n}\n\nfunction buildMatchRelated(workPoolIds: string[]): MatchRelated {\n\tif (workPoolIds.length === 0) {\n\t\treturn {};\n\t}\n\n\tconst resourceIds = workPoolIds.map((id) => `prefect.work-pool.${id}`);\n\n\treturn {\n\t\t\"prefect.resource.role\": \"work-pool\",\n\t\t\"prefect.resource.id\": resourceIds,\n\t};\n}\n\nfunction buildMatch(workQueueIds: string[]): Match {\n\tif (workQueueIds.length === 0) {\n\t\treturn { \"prefect.resource.id\": \"prefect.work-queue.*\" };\n\t}\n\n\tconst resourceIds = workQueueIds.map((id) => `prefect.work-queue.${id}`);\n\n\treturn {\n\t\t\"prefect.resource.id\": resourceIds,\n\t};\n}\n\nexport const WorkQueueStatusTriggerFields = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst posture = useWatch<AutomationWizardSchema>({ name: \"trigger.posture\" });\n\n\tconst matchRelated = useWatch<AutomationWizardSchema>({\n\t\tname: \"trigger.match_related\",\n\t}) as MatchRelated;\n\n\tconst match = useWatch<AutomationWizardSchema>({\n\t\tname: \"trigger.match\",\n\t}) as Match;\n\n\tconst selectedWorkPoolIds = extractWorkPoolIdsFromMatchRelated(matchRelated);\n\tconst selectedWorkQueueIds = extractWorkQueueIdsFromMatch(match);\n\n\tconst handleWorkPoolToggle = (workPoolId: string) => {\n\t\tconst currentWorkPoolIds = selectedWorkPoolIds;\n\t\tconst newWorkPoolIds = currentWorkPoolIds.includes(workPoolId)\n\t\t\t? currentWorkPoolIds.filter((id) => id !== workPoolId)\n\t\t\t: [...currentWorkPoolIds, workPoolId];\n\n\t\tform.setValue(\"trigger.match_related\", buildMatchRelated(newWorkPoolIds));\n\t};\n\n\tconst handleWorkQueueToggle = (workQueueId: string) => {\n\t\tconst currentWorkQueueIds = selectedWorkQueueIds;\n\t\tconst newWorkQueueIds = currentWorkQueueIds.includes(workQueueId)\n\t\t\t? currentWorkQueueIds.filter((id) => id !== workQueueId)\n\t\t\t: [...currentWorkQueueIds, workQueueId];\n\n\t\tform.setValue(\"trigger.match\", buildMatch(newWorkQueueIds));\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<FormItem>\n\t\t\t\t<FormLabel>Work Pools</FormLabel>\n\t\t\t\t<FormControl>\n\t\t\t\t\t<WorkPoolsCombobox\n\t\t\t\t\t\tselectedWorkPoolIds={selectedWorkPoolIds}\n\t\t\t\t\t\tonToggleWorkPool={handleWorkPoolToggle}\n\t\t\t\t\t\temptyMessage=\"All work pools\"\n\t\t\t\t\t/>\n\t\t\t\t</FormControl>\n\t\t\t</FormItem>\n\n\t\t\t<FormItem>\n\t\t\t\t<FormLabel>Work Queues</FormLabel>\n\t\t\t\t<FormControl>\n\t\t\t\t\t<WorkQueuesCombobox\n\t\t\t\t\t\tselectedWorkQueueIds={selectedWorkQueueIds}\n\t\t\t\t\t\tonToggleWorkQueue={handleWorkQueueToggle}\n\t\t\t\t\t\tworkPoolIds={selectedWorkPoolIds}\n\t\t\t\t\t\temptyMessage=\"All work queues\"\n\t\t\t\t\t/>\n\t\t\t\t</FormControl>\n\t\t\t</FormItem>\n\n\t\t\t<FormItem>\n\t\t\t\t<FormLabel>Work Queue</FormLabel>\n\t\t\t\t<div className=\"grid grid-cols-[10rem_1fr] gap-2\">\n\t\t\t\t\t<PostureSelect />\n\t\t\t\t\t<FormField\n\t\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\t\tname=\"trigger.expect\"\n\t\t\t\t\t\trender={({ field }) => {\n\t\t\t\t\t\t\tconst selectedStatus = field.value?.[0];\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\t\t\tvalue={selectedStatus ?? \"\"}\n\t\t\t\t\t\t\t\t\t\tonValueChange={(value) => field.onChange([value])}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<SelectTrigger className=\"w-full\">\n\t\t\t\t\t\t\t\t\t\t\t<SelectValue placeholder=\"Select status\" />\n\t\t\t\t\t\t\t\t\t\t</SelectTrigger>\n\t\t\t\t\t\t\t\t\t\t<SelectContent>\n\t\t\t\t\t\t\t\t\t\t\t{WORK_QUEUE_STATUSES.map((status) => (\n\t\t\t\t\t\t\t\t\t\t\t\t<SelectItem key={status.value} value={status.value}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{status.label}\n\t\t\t\t\t\t\t\t\t\t\t\t</SelectItem>\n\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t</SelectContent>\n\t\t\t\t\t\t\t\t\t</Select>\n\t\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</FormItem>\n\n\t\t\t{posture === \"Proactive\" && (\n\t\t\t\t<FormField\n\t\t\t\t\tcontrol={form.control}\n\t\t\t\t\tname=\"trigger.within\"\n\t\t\t\t\trender={({ field }) => (\n\t\t\t\t\t\t<FormItem>\n\t\t\t\t\t\t\t<FormLabel>For</FormLabel>\n\t\t\t\t\t\t\t<FormControl>\n\t\t\t\t\t\t\t\t<DurationInput\n\t\t\t\t\t\t\t\t\tvalue={field.value ?? 0}\n\t\t\t\t\t\t\t\t\tonChange={field.onChange}\n\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</FormControl>\n\t\t\t\t\t\t\t<FormMessage />\n\t\t\t\t\t\t</FormItem>\n\t\t\t\t\t)}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import { useCallback, useEffect, useState } from \"react\";\nimport { useFormContext } from \"react-hook-form\";\nimport { z } from \"zod\";\nimport {\n\ttype AutomationWizardSchema,\n\ttype Trigger,\n\tTriggerSchema,\n} from \"@/components/automations/automations-wizard/automation-schema\";\nimport {\n\ttype TriggerTemplate,\n\tTriggerTemplateSelectField,\n} from \"@/components/automations/automations-wizard/automations-trigger-template-select\";\nimport { CustomTriggerFields } from \"./custom-trigger-fields\";\nimport { DeploymentStatusTriggerFields } from \"./deployment-status-trigger-fields\";\nimport { FlowRunStateTriggerFields } from \"./flow-run-state-trigger-fields\";\nimport { type FormMode, FormModeToggle } from \"./form-mode-toggle\";\nimport { TriggerJsonInput } from \"./trigger-json-input\";\nimport { getDefaultTriggerForTemplate } from \"./trigger-step-utils\";\nimport { WorkPoolStatusTriggerFields } from \"./work-pool-status-trigger-fields\";\nimport { WorkQueueStatusTriggerFields } from \"./work-queue-status-trigger-fields\";\n\nexport const TriggerStep = () => {\n\tconst form = useFormContext<AutomationWizardSchema>();\n\tconst triggerTemplate = form.watch(\"triggerTemplate\");\n\tconst trigger = form.watch(\"trigger\");\n\n\tconst [mode, setMode] = useState<FormMode>(\"Form\");\n\tconst [jsonString, setJsonString] = useState<string>(\"\");\n\tconst [jsonError, setJsonError] = useState<string | undefined>(undefined);\n\n\t// Serialize trigger to JSON string\n\tconst serializeTrigger = useCallback(() => {\n\t\treturn JSON.stringify(trigger, null, 2);\n\t}, [trigger]);\n\n\t// Update jsonString when trigger changes (while in Form mode)\n\tuseEffect(() => {\n\t\tif (mode === \"Form\") {\n\t\t\tsetJsonString(serializeTrigger());\n\t\t}\n\t}, [mode, serializeTrigger]);\n\n\t// Validate and parse JSON string\n\tconst validateAndParseJson = useCallback(\n\t\t(json: string): { valid: boolean; trigger?: Trigger; error?: string } => {\n\t\t\ttry {\n\t\t\t\tconst parsed: unknown = JSON.parse(json);\n\t\t\t\tconst validatedTrigger = TriggerSchema.parse(parsed);\n\t\t\t\treturn { valid: true, trigger: validatedTrigger };\n\t\t\t} catch (e) {\n\t\t\t\tif (e instanceof SyntaxError) {\n\t\t\t\t\treturn { valid: false, error: \"Invalid JSON syntax\" };\n\t\t\t\t}\n\t\t\t\tif (e instanceof z.ZodError) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalid: false,\n\t\t\t\t\t\terror: e.errors[0]?.message ?? \"Invalid trigger configuration\",\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn { valid: false, error: \"Unknown error\" };\n\t\t\t}\n\t\t},\n\t\t[],\n\t);\n\n\t// Handle mode change with validation\n\tconst handleModeChange = useCallback(\n\t\t(newMode: FormMode) => {\n\t\t\tif (mode === newMode) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newMode === \"Form\") {\n\t\t\t\t// Switching from JSON to Form - validate and sync JSON to form\n\t\t\t\tconst result = validateAndParseJson(jsonString);\n\t\t\t\tif (!result.valid) {\n\t\t\t\t\tsetJsonError(result.error);\n\t\t\t\t\treturn; // Block switch if JSON is invalid\n\t\t\t\t}\n\t\t\t\t// Update form with parsed trigger\n\t\t\t\tif (result.trigger) {\n\t\t\t\t\tform.setValue(\"trigger\", result.trigger);\n\t\t\t\t}\n\t\t\t\tsetJsonError(undefined);\n\t\t\t} else {\n\t\t\t\t// Switching from Form to JSON - serialize current trigger\n\t\t\t\tsetJsonString(serializeTrigger());\n\t\t\t\tsetJsonError(undefined);\n\t\t\t}\n\n\t\t\tsetMode(newMode);\n\t\t},\n\t\t[mode, jsonString, validateAndParseJson, form, serializeTrigger],\n\t);\n\n\t// Handle JSON input changes - immediately sync valid JSON to form\n\tconst handleJsonChange = useCallback(\n\t\t(value: string) => {\n\t\t\tsetJsonString(value);\n\n\t\t\t// Try to parse and validate the JSON\n\t\t\tconst result = validateAndParseJson(value);\n\t\t\tif (result.valid && result.trigger) {\n\t\t\t\t// Valid JSON - sync to form immediately\n\t\t\t\tform.setValue(\"trigger\", result.trigger);\n\t\t\t\tsetJsonError(undefined);\n\t\t\t}\n\t\t\t// Don't set error on every keystroke - only on blur or mode switch\n\t\t},\n\t\t[validateAndParseJson, form],\n\t);\n\n\tconst handleTemplateChange = (value: TriggerTemplate) => {\n\t\tconst newTrigger = getDefaultTriggerForTemplate(value);\n\t\tform.setValue(\"trigger\", newTrigger);\n\t\t// Reset JSON string when template changes\n\t\tsetJsonString(JSON.stringify(newTrigger, null, 2));\n\t\tsetJsonError(undefined);\n\t};\n\n\treturn (\n\t\t<div className=\"space-y-6\">\n\t\t\t<TriggerTemplateSelectField onTemplateChange={handleTemplateChange} />\n\t\t\t{triggerTemplate && (\n\t\t\t\t<FormModeToggle\n\t\t\t\t\tvalue={mode}\n\t\t\t\t\tonValueChange={handleModeChange}\n\t\t\t\t\tformContent={<TriggerTemplateFields template={triggerTemplate} />}\n\t\t\t\t\tjsonContent={\n\t\t\t\t\t\t<TriggerJsonInput\n\t\t\t\t\t\t\tvalue={jsonString}\n\t\t\t\t\t\t\tonChange={handleJsonChange}\n\t\t\t\t\t\t\terror={jsonError}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\ntype TriggerTemplateFieldsProps = {\n\ttemplate: TriggerTemplate;\n};\n\nconst TriggerTemplateFields = ({ template }: TriggerTemplateFieldsProps) => {\n\tswitch (template) {\n\t\tcase \"flow-run-state\":\n\t\t\treturn <FlowRunStateTriggerFields />;\n\t\tcase \"deployment-status\":\n\t\t\treturn <DeploymentStatusTriggerFields />;\n\t\tcase \"work-pool-status\":\n\t\t\treturn <WorkPoolStatusTriggerFields />;\n\t\tcase \"work-queue-status\":\n\t\t\treturn <WorkQueueStatusTriggerFields />;\n\t\tcase \"custom\":\n\t\t\treturn <CustomTriggerFields />;\n\t\tdefault:\n\t\t\treturn null;\n\t}\n};\n","import { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Link } from \"@tanstack/react-router\";\nimport { useForm } from \"react-hook-form\";\nimport type { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardFooter } from \"@/components/ui/card\";\nimport { Form, FormMessage } from \"@/components/ui/form\";\nimport { Stepper } from \"@/components/ui/stepper\";\nimport { useStepper } from \"@/hooks/use-stepper\";\nimport { ActionsStep } from \"./actions-step\";\nimport { AutomationWizardSchema } from \"./automation-schema\";\nimport { DetailsStep } from \"./details-step\";\nimport { TriggerStep } from \"./trigger-step\";\n\ntype AutomationWizardFormInput = z.input<typeof AutomationWizardSchema>;\ntype AutomationWizardFormOutput = z.output<typeof AutomationWizardSchema>;\n\nconst WIZARD_STEPS = [\"Trigger\", \"Actions\", \"Details\"] as const;\ntype WizardStep = (typeof WIZARD_STEPS)[number];\n\nconst DEFAULT_FORM_VALUES = {\n\tactions: [{ type: undefined }],\n\ttrigger: {\n\t\ttype: \"event\" as const,\n\t\tposture: \"Reactive\" as const,\n\t\tthreshold: 1,\n\t\twithin: 0,\n\t},\n};\n\nexport type AutomationWizardProps = {\n\tdefaultValues?: Partial<AutomationWizardFormInput>;\n\tonSubmit: (values: AutomationWizardFormOutput) => void;\n\tsubmitLabel?: string;\n\tisSubmitting?: boolean;\n};\n\nexport const AutomationWizard = ({\n\tdefaultValues = {},\n\tonSubmit,\n\tsubmitLabel = \"Save\",\n\tisSubmitting = false,\n}: AutomationWizardProps) => {\n\tconst isEditMode = Boolean(\n\t\tdefaultValues && Object.keys(defaultValues).length > 0,\n\t);\n\tconst initialVisitedSteps = isEditMode\n\t\t? new Set([0, 1, 2])\n\t\t: new Set<number>([0]);\n\tconst stepper = useStepper(WIZARD_STEPS.length, 0, initialVisitedSteps);\n\tconst form = useForm<\n\t\tAutomationWizardFormInput,\n\t\tunknown,\n\t\tAutomationWizardFormOutput\n\t>({\n\t\tresolver: zodResolver(AutomationWizardSchema),\n\t\tdefaultValues: {\n\t\t\t...DEFAULT_FORM_VALUES,\n\t\t\t...defaultValues,\n\t\t} as AutomationWizardFormInput,\n\t});\n\n\tconst currentStep = WIZARD_STEPS[stepper.currentStep];\n\tconst WIZARD_STEPS_MAP = {\n\t\tTrigger: {\n\t\t\trender: () => <TriggerStep />,\n\t\t\ttrigger: () => form.trigger(\"trigger\"),\n\t\t},\n\t\tActions: {\n\t\t\trender: () => <ActionsStep />,\n\t\t\ttrigger: () => form.trigger(\"actions\"),\n\t\t},\n\t\tDetails: {\n\t\t\trender: () => <DetailsStep />,\n\t\t\ttrigger: () => form.trigger([\"description\", \"name\"]),\n\t\t},\n\t} as const;\n\n\tconst handleIncrementStep = async (step: WizardStep) => {\n\t\tconst isValid = await WIZARD_STEPS_MAP[step].trigger();\n\t\tif (isValid) {\n\t\t\tstepper.incrementStep();\n\t\t}\n\t};\n\n\treturn (\n\t\t<Form {...form}>\n\t\t\t<form onSubmit={(e) => void form.handleSubmit(onSubmit)(e)}>\n\t\t\t\t<div className=\"flex flex-col gap-8\">\n\t\t\t\t\t<Stepper\n\t\t\t\t\t\tsteps={WIZARD_STEPS}\n\t\t\t\t\t\tcurrentStepNum={stepper.currentStep}\n\t\t\t\t\t\tonClick={(step) => stepper.changeStep(step.stepNum)}\n\t\t\t\t\t\tcompletedSteps={stepper.completedStepsSet}\n\t\t\t\t\t\tvisitedSteps={stepper.visitedStepsSet}\n\t\t\t\t\t/>\n\t\t\t\t\t<Card className=\"p-4 pt-8\">\n\t\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t\t{WIZARD_STEPS_MAP[currentStep].render()}\n\t\t\t\t\t\t\t<FormMessage>{form.formState.errors.root?.message}</FormMessage>\n\t\t\t\t\t\t</CardContent>\n\t\t\t\t\t\t<CardFooter className=\"mt-6 flex gap-2 justify-end\">\n\t\t\t\t\t\t\t<Button type=\"button\" variant=\"outline\">\n\t\t\t\t\t\t\t\t<Link to=\"/automations\">Cancel</Link>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tdisabled={stepper.isStartingStep}\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tonClick={stepper.decrementStep}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tPrevious\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t{stepper.isFinalStep ? (\n\t\t\t\t\t\t\t\t<Button key=\"save\" type=\"submit\" loading={isSubmitting}>\n\t\t\t\t\t\t\t\t\t{submitLabel}\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tkey=\"next\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tonClick={() => void handleIncrementStep(currentStep)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tNext\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</CardFooter>\n\t\t\t\t\t</Card>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</Form>\n\t);\n};\n"],"names":["AUTOMATION_ACTION_TYPES","ActionTypeSelect","index","form","useFormContext","jsx","FormField","field","FormItem","FormLabel","FormControl","jsxs","Select","type","defaultActionField","getDefaultActionField","UNASSIGNED","SelectTrigger","SelectValue","SelectContent","SelectGroup","SelectLabel","key","SelectItem","ChangeFlowRunStateFields","stateField","Fragment","StateSelect","FormMessage","Input","RUN_STATES","Textarea","FlowRunActionDescription","action","text","Typography","DEFAULT_NUM_SKELETONS","LoadingSelectState","length","_","Skeleton","INFER_OPTION","getButtonLabel","data","fieldValue","automation","SelectAutomationsFields","search","setSearch","useState","isSuccess","useQuery","buildListAutomationsQuery","deferredSearch","useDeferredValue","filteredData","useMemo","isInferredOptionFiltered","buttonLabel","Combobox","ComboboxTrigger","ComboboxContent","ComboboxCommandInput","ComboboxCommandEmtpy","ComboboxCommandList","ComboboxCommandGroup","ComboboxCommandItem","value","useListDeploymentsWithFlows","filter","deploymentsData","deploymentsStatus","buildPaginateDeploymentsQuery","deploymentsFlowIds","deployment","flowsData","flowsStatus","buildListFlowsQuery","flowMap","flow","deploymentsWithFlows","count","limit","pages","page","d","DeploymentLabel","SelectDeploymentsFields","actionType","deploymentId","useWatch","debouncedSearch","useDebounce","deploymentWithFlow","Icon","workPool","wp","SelectWorkPoolsFields","buildFilterWorkPoolsQuery","workQueue","wq","SelectWorkQueuesFields","buildFilterWorkQueuesQuery","filteredMap","filteredWorkQueues","work_pool_name","workPoolName","workQueues","SendNotificationFields","blockTypes","isLoadingBlockTypes","buildListFilterBlockTypesQuery","blockTypeSlugs","bt","blockDocuments","isLoadingBlockDocuments","buildListFilterBlockDocumentsQuery","isLoading","groupedBlockDocuments","blockType","doc","group","filteredGroups","lowerSearch","getSelectedBlockDocument","useCallback","blockDocumentId","selectedDoc","TemplateField","name","label","placeholder","multiline","validateTemplate","useValidateTemplate","validationError","setValidationError","isValidating","setIsValidating","debouncedValue","useEffect","result","InputComponent","ActionStep","onRemove","Button","ActionTypeAdditionalFields","ActionsStep","fields","append","remove","useFieldArray","id","DetailsStep","POSTURE_OPTIONS","DEFAULT_PROACTIVE_WITHIN","PostureSelect","previousPosture","expectValues","afterValues","option","CustomTriggerFields","posture","textValue","e","lines","line","DEPLOYMENT_STATUSES","DeploymentStatusTriggerFields","selectedStatus","status","MAX_VISIBLE_FLOWS","FlowMultiSelect","selectedFlowIds","onToggleFlow","emptyMessage","flows","selectedFlowsData","filteredFlows","renderSelectedFlows","visibleNames","overflow","SECONDS_IN_MINUTE","SECONDS_IN_HOUR","SECONDS_IN_DAY","DURATION_UNITS","getDefaultUnitForValue","DurationInput","onChange","min","className","disabled","unit","setUnit","availableUnits","u","quantity","handleQuantityChange","newQuantity","handleUnitChange","newUnitValue","newUnit","oldUnit","firstAvailable","cn","ALL_RUN_STATES","ALL_EXCEPT_SCHEDULED","isAllExceptScheduled","states","STATE_NAMES","StateMultiSelect","selectedStates","onStateChange","displayValue","filteredStates","showConvenienceOptions","handleConvenienceSelect","STATE_NAMES_WITHOUT_SCHEDULED","handleStateToggle","stateName","s","renderSelectedStates","StateBadge","STATE_NAME_TO_TYPE","toStateNameEvents","stateNames","fromStateNameEvents","events","event","extractFlowIdsFromMatchRelated","matchRelated","resourceIds","extractTagsFromMatchRelated","buildMatchRelated","flowIds","tags","flowResourceIds","tagResourceIds","tag","role","FlowRunStateTriggerFields","stateFieldName","selectedTags","handleFlowToggle","flowId","currentFlowIds","newFlowIds","newTags","handleTagsChange","showTagsInput","TagsInput","eventStrings","FormModeToggle","defaultValue","onValueChange","formContent","jsonContent","tabsProps","Tabs","TabsList","TabsTrigger","TabsContent","TriggerJsonInput","error","localError","setLocalError","formatJson","parsed","validate","json","TriggerSchema","z.ZodError","Label","JsonInput","TEMPLATE_TRIGGERS","AutomationsTriggerTemplateSelect","TriggerTemplateSelectField","onTemplateChange","BASE_TRIGGER","getDefaultTriggerForTemplate","template","WorkPoolMultiSelect","selectedWorkPoolIds","onToggleWorkPool","workPools","filteredWorkPools","selectedWorkPoolsData","renderSelectedWorkPools","selectedWorkPoolNames","WORK_POOL_STATUSES","getStatusFromEvents","getEventsForStatus","statusValue","getEventsExceptStatus","extractWorkPoolIdsFromMatch","match","buildMatch","workPoolIds","StatusSelect","expect","after","currentStatus","handleStatusChange","statusEvents","otherStatusEvents","WorkPoolStatusTriggerFields","handleWorkPoolToggle","workPoolId","currentWorkPoolIds","newWorkPoolIds","WorkPoolsCombobox","WorkQueuesCombobox","selectedWorkQueueIds","onToggleWorkQueue","groupedWorkQueues","groups","poolName","a","b","renderSelectedWorkQueues","selectedWorkQueueNames","WORK_QUEUE_STATUSES","extractWorkPoolIdsFromMatchRelated","extractWorkQueueIdsFromMatch","ids","workQueueIds","WorkQueueStatusTriggerFields","handleWorkQueueToggle","workQueueId","currentWorkQueueIds","newWorkQueueIds","TriggerStep","triggerTemplate","trigger","mode","setMode","jsonString","setJsonString","jsonError","setJsonError","serializeTrigger","validateAndParseJson","handleModeChange","newMode","handleJsonChange","handleTemplateChange","newTrigger","TriggerTemplateFields","WIZARD_STEPS","DEFAULT_FORM_VALUES","AutomationWizard","defaultValues","onSubmit","submitLabel","isSubmitting","initialVisitedSteps","stepper","useStepper","useForm","zodResolver","AutomationWizardSchema","currentStep","WIZARD_STEPS_MAP","handleIncrementStep","step","Form","Stepper","Card","CardContent","CardFooter","Link"],"mappings":"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"}